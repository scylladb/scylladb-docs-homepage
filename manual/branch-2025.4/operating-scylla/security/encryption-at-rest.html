

<!DOCTYPE html>
<html class="no-js" lang="en" style="visibility: hidden;">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Encryption at Rest | ScyllaDB Docs 
        </title>
        <meta name="description" content="ScyllaDB is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://docs.scylladb.com/manual/stable/operating-scylla/security/encryption-at-rest.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                  href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>

        
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/biel-search@latest/dist/biel-search/biel-search.css">
            <script type="module" src="https://cdn.jsdelivr.net/npm/biel-search@latest/dist/biel-search/biel-search.esm.js"></script>
        

        
            
                <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/css/main.css?v=0ebb4bd5" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/sphinx_collapse.css?v=226d88b4" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=5a6d8084" />
            
        
    
        
        
    
    
    
            
        <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
        
            
                <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
            
        
            
                <script src="../../_static/doctools.js?v=9bcbadda"></script>
            
        
            
                <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
            
        
            
                <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
            
        
            
                <script src="../../_static/copybutton.js?v=f281be69"></script>
            
        
            
                <script src="../../_static/tabs.js?v=3030b3cb"></script>
            
        
    
            
                <!-- Local meta tags -->
            
            
                <!-- Google Tag Manager docs -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-54NWVS4");
</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager global -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
            
        

    </head>

    <body class="brand-self-hosted">
        <section class="promo-banner  promo-banner--hide" style="display: none;">
    <div class="promo-banner-wrapper">
        <div class="promo-banner__content">
            
            <div class="promo-banner__title">ScyllaDB University LIVE, FREE Virtual Training Event | March 21</div>
            <a class="promo-banner__button button button--reverse" href="https://lp.scylladb.com/university-live-2023-03-registration?siteplacement=docs"
               target="_blank" rel="noopener noreferrer">Register for Free</a>
        </div>
        <button class="promo-banner__close">
            <i class="icon-cancel"></i>
        </button>
    </div>
</section>
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../../_static/img/scylladb-logo-horizontal.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Deployments <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="icon-docs-cloud"></i>Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/manual/">
                            <i class="icon-server"></i>Server</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="icon-docs-manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="icon-docs-monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="icon-docs-operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/stable/drivers/cql-drivers">
                            <i class="icon-docs-nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/stable/drivers/dynamo-drivers">
                            <i class="icon-docs-alternator"></i>DynamoDB Drivers
                        </a>

                        <li>
                            <a href="https://docs.scylladb.com/stable/versioning/driver-support">
                                <i class="icon-docs-blog"></i>Supported Driver Versions
                            </a>
                        </li>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Resources
                    <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://university.scylladb.com">
                            <i class="icon-university"></i>
                            ScyllaDB University
                        </a>
                    </li>
                    <li>
                        <a href="https://forum.scylladb.com">
                            <i class="icon-docs-community"></i>
                            Community Forum
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/stable/get-started/develop-with-scylladb/tutorials-example-projects.html">
                            <i class="icon-docs-training"></i>
                            Tutorials
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://docs.scylladb.com/manual/stable/getting-started/installation-common/scylla-web-installer.html" class="button"><i class="icon-download me-2"></i> Install</a>
        </div>
    </div>
    <div class="header-search-box">
        <i class="dark-theme-toggler icon-theme"></i>
        <div class="search-box">
            <ci-search></ci-search>
        </div>
        
            <biel-button class="header-ask-ai" project="ddfdo8m94k"
                         header-title="ScyllaDB chatbot (beta)"
                         button-position="default"
                         modal-position="bottom-right"
                         button-style="dark">
                Ask AI
            </biel-button>
        
    </div>
    <div class="side-nav-toggle">
    <i class="dark-theme-toggler icon-theme"></i>
    <div class="side-nav-toggle__button" data-toggle="side-nav">
        <i class="icon-menu"></i>
    </div>
</div>
</header>
        <div class="title"></div>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
           class="bread__highlight">
            <i class="icon-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="../../index.html"
           class="bread__highlight">
            ScyllaDB Manual
        </a>
    </span>
    
        <span class="bread__item">
            <a href="../index.html" class="bread__highlight">
                ScyllaDB for Administrators
            </a>
        </span>
    
        <span class="bread__item">
            <a href="index.html" class="bread__highlight">
                Security
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Encryption at Rest</span>
</div>
                    </div>
                
                
                    <div class="sidebar-right-layout">
                        <div class="body-container">
                

                <div class="content-body">
                    
                        
                    

                    <section id="encryption-at-rest">
<h1>Encryption at Rest<a class="headerlink" href="#encryption-at-rest" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>ScyllaDB protects your sensitive data with data-at-rest encryption. It protects
the privacy of your users’ data, reduces the risk of data breaches, and helps
meet regulatory requirements. In particular, it provides an additional level of
protection for your data persisted in storage or its backups.</p>
<p>When ScyllaDB’s Encryption at Rest is used together with Encryption in Transit
(<a class="reference internal" href="node-node-encryption.html"><span class="doc">Node to Node</span></a> and
<a class="reference internal" href="client-node-encryption.html"><span class="doc">Client to Node</span></a>), you
benefit from end to end data encryption.</p>
</section>
<section id="about-encryption-at-rest">
<h2>About Encryption at Rest<a class="headerlink" href="#about-encryption-at-rest" title="Link to this heading">¶</a></h2>
<p>The following can be encrypted:</p>
<ul class="simple">
<li><p>ScyllaDB persistent tables (SSTables):</p>
<ul>
<li><p>User tables</p></li>
<li><p>System tables: <code class="docutils literal notranslate"><span class="pre">system.batchlog</span></code>, <code class="docutils literal notranslate"><span class="pre">system.paxos</span></code>, <code class="docutils literal notranslate"><span class="pre">system.dicts</span></code></p></li>
</ul>
</li>
<li><p>System level data:</p>
<ul>
<li><p>Commit logs</p></li>
<li><p>Hints</p></li>
</ul>
</li>
</ul>
<p>Encryption at Rest can be configured at table granularity, so you can choose to
encrypt only sensitive tables. For both system and table data, you can use
different block cipher algorithms that are supported by <a class="reference external" href="https://www.openssl.org/">OpenSSL</a>, in different modes of operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SSTables of a particular table may be encrypted with different block
ciphers, modes of operation, and keys; or not be encrypted at all - at the
same time.</p>
</div>
<section id="when-is-data-encrypted">
<h3>When is Data Encrypted?<a class="headerlink" href="#when-is-data-encrypted" title="Link to this heading">¶</a></h3>
<p>As SSTables are immutable, they are encrypted only once, as a result of memtable
flush, compaction, or upgrade (with <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">Nodetool upgradesstables</span></a>). Similarly, system
artifacts are encrypted when they are written. Encryption configuration takes
effect at the time of write, and is persisted in the given SSTable’s metadata
file (<code class="docutils literal notranslate"><span class="pre">Scylla.db</span></code>), or the given system artifact’s (e.g. commit log’s)
metadata file, respectively.</p>
<p>SSTables of a table, on a particular node, are encrypted using the most recently
configured algorithm and key that apply to that table and node. When you enable
encryption for an existing table, only subsequently written SSTables are
encrypted accordingly. Old SSTables that existed before (re)configuring
encryption are not updated. Those SSTables remain encrypted (or not encrypted at
all) according to the configuration that was in effect when they were written.</p>
</section>
<section id="when-is-data-decrypted">
<h3>When is Data Decrypted?<a class="headerlink" href="#when-is-data-decrypted" title="Link to this heading">¶</a></h3>
<p>When ScyllaDB reads an encrypted SSTable from disk, it fetches the
<a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">algorithm descriptor</span></a> (identifying block cipher,
key size, and mode of operation) from the SSTable’s metadata file
(<code class="docutils literal notranslate"><span class="pre">Scylla.db</span></code>). ScyllaDB extracts the key from the key provider (which is
recorded in the same SSTable metadata file), and then decrypts the other SSTable
components with the key.</p>
<p>When ScyllaDB reads an encrypted system artifact, such as a commit log, it
fetches the algorithm descriptor and the key provider from the commit log
segment’s metadata file. ScyllaDB extracts the key from the key provider, and
then decrypts the system artifact with the key.</p>
</section>
</section>
<section id="data-classes-for-encryption">
<h2>Data Classes for Encryption<a class="headerlink" href="#data-classes-for-encryption" title="Link to this heading">¶</a></h2>
<p>ScyllaDB supports encryption for both system and user data. Encryption behaves
similarly for both data classes, but it is configured differently for each
class:</p>
<ul>
<li><p>Encryption for system and user data must be configured separately in
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>, through the <code class="docutils literal notranslate"><span class="pre">system_info_encryption</span></code> and
<code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> sections, respectively. This separation allows to
select different configuration properties for each data class.</p></li>
<li><p>Encryption for user data can be configured at two levels:</p>
<ul class="simple">
<li><p>Node-level configuration: Using the <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> section in
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>.</p></li>
<li><p>Table-level configuration: Using the <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> in the
table schema.</p></li>
</ul>
<p>The table-level options are both finer-grained and coarser-grained than the
SSTable encryption defaults in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>:</p>
<ul class="simple">
<li><p>They are finer-grained because they override any possible defaults in
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> for a particular table.</p></li>
<li><p>They are coarser-grained because they apply to all nodes in the cluster that
write out new SSTables for the table, while the options configured in
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> apply only to a particular node.</p></li>
</ul>
</li>
</ul>
</section>
<section id="cipher-algorithm-descriptors">
<span id="ear-cipher-algorithms"></span><h2>Cipher Algorithm Descriptors<a class="headerlink" href="#cipher-algorithm-descriptors" title="Link to this heading">¶</a></h2>
<p>The following block cipher, mode of operation, and key size combinations are
available for use with ScyllaDB using <a class="reference external" href="https://www.openssl.org/">OpenSSL</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 70.0%" />
<col style="width: 30.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AES/CBC/PKCS5Padding</span></code> (<strong>default</strong>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">128</span></code> (<strong>default</strong>), <code class="docutils literal notranslate"><span class="pre">192</span></code>, or <code class="docutils literal notranslate"><span class="pre">256</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AES/ECB/PKCS5Padding</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">128</span></code>, <code class="docutils literal notranslate"><span class="pre">192</span></code>, or <code class="docutils literal notranslate"><span class="pre">256</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Blowfish/CBC/PKCS5Padding</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">128</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>The ECB (Electronic Code Book) mode of operation is less secure than CBC (Cipher
Block Chaining).</p>
<p>The Blowfish block cipher’s block size is 64 bits, while AES has a 128-bit block
size. Therefore, Blowfish may leak information when encrypting more than a few
GB of data with the same key.</p>
<p>The default algorithm (<code class="docutils literal notranslate"><span class="pre">AES/CBC/PKCS5Padding</span></code> with key strength <code class="docutils literal notranslate"><span class="pre">128</span></code>) is
strongly recommended.</p>
</section>
<section id="key-providers">
<span id="ear-key-providers"></span><h2>Key Providers<a class="headerlink" href="#key-providers" title="Link to this heading">¶</a></h2>
<p>When encrypting the system tables or SSTables, you need to state which provider
is holding your keys. You can use the following options:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key Provider Name</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Local Key Provider</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LocalFileSystemKeyProviderFactory</span></code> (<strong>default</strong>)</p></td>
<td><p>Stores the key on the same machine as the data.</p></td>
</tr>
<tr class="row-odd"><td><p>Replicated Key Provider</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ReplicatedKeyProviderFactory</span></code></p></td>
<td><p>Stores table keys in a ScyllaDB table where the table itself is encrypted
using the system key.</p></td>
</tr>
<tr class="row-even"><td><p>KMIP Key Provider</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">KmipKeyProviderFactory</span></code></p></td>
<td><p>Stores key(s) in an external Key Management Server using the Key
Management Interoperability Protocol (KMIP).</p></td>
</tr>
<tr class="row-odd"><td><p>KMS Key Provider</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">KmsKeyProviderFactory</span></code></p></td>
<td><p>Uses key(s) provided by the AWS KMS service.</p></td>
</tr>
<tr class="row-even"><td><p>GCP Key Provider</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GcpKeyProviderFactory</span></code></p></td>
<td><p>Uses key(s) provided by the GCP KMS service.</p></td>
</tr>
<tr class="row-odd"><td><p>Azure Key Provider</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AzureKeyProviderFactory</span></code></p></td>
<td><p>Uses key(s) provided by the Azure Key Vault service.</p></td>
</tr>
</tbody>
</table>
<p>Each available key provider is further described at a high level in the
following sections. Instructions on how to configure them are provided in later
sections.</p>
<section id="local-key-provider">
<h3>Local Key Provider<a class="headerlink" href="#local-key-provider" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Local Key Provider is less safe than other options and as such it is not
recommended for production use. It is the default key provider for the
node-local encryption configuration in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> because it does not
require any external resources. In production environments, it is recommended
to use an external KMS instead.</p>
</div>
<p>The Local Key Provider is the default key provider for the node-local encryption
configuration in ScyllaDB (<code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> and <code class="docutils literal notranslate"><span class="pre">system_info_encryption</span></code>
in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>). It stores the encryption keys locally on disk in a text file.
The location of this file is specified in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>, or in the table schema.
The user has the option to generate the key(s) themselves, or let ScyllaDB
generate the key(s) for them.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Care should be taken so that no unauthorized person can access the key data
from the file system. Make sure that the owner of this file is the <code class="docutils literal notranslate"><span class="pre">scylla</span></code>
user and that the file is <strong>not</strong> readable by <strong>other users</strong>, or accessible
by <strong>other roles</strong>.</p>
</div>
<p>You should also consider keeping the key directory on a network drive (using TLS
for the file sharing) to avoid having keys and data on the same storage media,
in case your storage is stolen or discarded.</p>
</section>
<section id="replicated-key-provider">
<h3>Replicated Key Provider<a class="headerlink" href="#replicated-key-provider" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Replicated Key Provider is not recommended for production use because it
does not support key rotation. For compatibility with DataStax Cassandra, it
is the default key provider for per-table encryption setup. In production
environments, an external KMS should be used instead.</p>
</div>
<p>The Replicated Key Provider is the default key provider for per-table encryption
setup in ScyllaDB (<code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> in table schema). It stores and
distributes the encryption keys across every node in the cluster through a
special ScyllaDB system table (<code class="docutils literal notranslate"><span class="pre">system_replicated_keys.encrypted_keys</span></code>). The
Replicated Key Provider requires two additional keys to operate:</p>
<ul class="simple">
<li><p>A system key - used to encrypt the data in the system table. The system key
can be either a local key, or a KMIP key.</p></li>
<li><p>A local secret key - used as a fallback key, in case the Replicated Key
Provider fails to retrieve a key from the system table.</p></li>
</ul>
<p>The Replicated Key Provider has some limitations:</p>
<ul class="simple">
<li><p>It cannot be selected as a node’s default encryption option for system or user
data in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>. It can only be configured per-table, through the
<code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> in the table schema.</p></li>
<li><p>It does not support key rotation.</p></li>
</ul>
</section>
<section id="kmip-key-provider">
<h3>KMIP Key Provider<a class="headerlink" href="#kmip-key-provider" title="Link to this heading">¶</a></h3>
<p>The KMIP Key Provider stores the encryption keys in an external Key Management
Service (KMS) that supports the Key Management Interoperability Protocol (KMIP).
The user has the option to generate the key(s) themselves, or let ScyllaDB
generate the key(s) for them. When creating a key or locating an existing key,
the key provider extracts the raw key material from the server and stores it in
a loading cache in memory.</p>
<p>Key rotation is supported, but the rotation must be performed by the user on the
KMIP server level.</p>
</section>
<section id="kms-key-provider">
<span id="ear-key-providers-kms"></span><h3>KMS Key Provider<a class="headerlink" href="#kms-key-provider" title="Link to this heading">¶</a></h3>
<p>The KMS Key Provider uses keys stored in the AWS Key Management Service (KMS).
These keys are expected to be pre-created and managed entirely by the user - the
KMS Key Provider does not create any KMS keys by itself. The user needs to
specify a KMS key in the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> configuration file, or in the table
schema, along with credentials to access this key.</p>
<p>The encryption of user or system data does not happen with KMS keys directly.
Instead, the KMS Key Provider generates another set of keys - the data
encryption keys - and wraps them with the KMS keys to securely store them on
disk along with the encrypted data. The data encryption keys remain encrypted on
disk at all times and they are temporarily stored unencrypted in memory while in
use.</p>
<p>The KMS Key Provider creates data encryption keys via the KMS’s
<code class="docutils literal notranslate"><span class="pre">GenerateDataKey</span></code> operation and decrypts wrapped keys via the <code class="docutils literal notranslate"><span class="pre">Decrypt</span></code>
operation. It also maintains data encryption keys in a loading cache to reuse
them for the encryption of multiple artifacts. Once a key expires from the
cache, it generates a new one via the KMS.</p>
<p>KMS key rotation is supported, but the rotation must be performed by the user.</p>
</section>
<section id="gcp-key-provider">
<span id="ear-key-providers-gcp"></span><h3>GCP Key Provider<a class="headerlink" href="#gcp-key-provider" title="Link to this heading">¶</a></h3>
<p>The GCP Key Provider uses keys stored in the Google Cloud Key Management Service
(KMS). The operating principle is similar to the <a class="reference internal" href="#ear-key-providers-kms"><span class="std std-ref">KMS Key Provider</span></a>, with the only difference that it generates the data
encryption keys locally. For key wrapping, it relies on the KMS’s <code class="docutils literal notranslate"><span class="pre">encrypt</span></code>
and <code class="docutils literal notranslate"><span class="pre">decrypt</span></code> operations.</p>
</section>
<section id="azure-key-provider">
<h3>Azure Key Provider<a class="headerlink" href="#azure-key-provider" title="Link to this heading">¶</a></h3>
<p>The Azure Key Provider uses keys stored in the Azure Key Vault service. It
follows the same approach as the <a class="reference internal" href="#ear-key-providers-gcp"><span class="std std-ref">GCP Key Provider</span></a>,
namely key wrapping with locally generated data encryption keys. Key wrapping is
implemented through Azure Key Vault’s <code class="docutils literal notranslate"><span class="pre">wrapkey</span></code> and <code class="docutils literal notranslate"><span class="pre">unwrapkey</span></code> operations.</p>
</section>
</section>
<section id="create-encryption-keys">
<span id="ear-create-encryption-key"></span><h2>Create Encryption Keys<a class="headerlink" href="#create-encryption-keys" title="Link to this heading">¶</a></h2>
<p>Depending on your key provider, you will either have the option to allow
ScyllaDB to generate an encryption key, or you will have to provide one:</p>
<ul class="simple">
<li><p>Local Key Provider - you can provide your own keys, otherwise ScyllaDB will generate them for you</p></li>
<li><p>Replicated Key Provider - you must generate a system key yourself</p></li>
<li><p>KMIP Key Provider - you can provide your own keys, otherwise ScyllaDB will generate them for you</p></li>
<li><p>KMS Key Provider - you must generate a key yourself in AWS</p></li>
<li><p>GCP Key Provider - you must generate a key yourself in GCP</p></li>
<li><p>Azure Key Provider - you must generate a key yourself in Azure</p></li>
</ul>
<p>To create your own key, select one of the following options, depending on your
desired key provider:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-0-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-0-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-0-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-0-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-0-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-0-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-0-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><p>The following procedure describes how you can use ScyllaDB’s key generator
script to generate local keys for your cluster.</p>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Select a local directory for storing your keys.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SCYLLA_LOCAL_KEYS_DIR=/etc/scylla/encryption_keys
</pre></div>
</div>
</li>
<li><p>Create the directory if it doesn’t exist, along with a sub-directory
for your system keys.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p ${SCYLLA_LOCAL_KEYS_DIR?}/system_keys
</pre></div>
</div>
</li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">scylla</span></code> user as the owner of the directory. Provide
<code class="docutils literal notranslate"><span class="pre">scylla</span></code> user with Read, Write, and Execute permissions over this
directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo chown -R scylla:scylla ${SCYLLA_LOCAL_KEYS_DIR?}
sudo chmod -R 700 ${SCYLLA_LOCAL_KEYS_DIR?}
</pre></div>
</div>
</li>
<li><p>Create a key using the local file key generator script, making sure
that the key file owner is <code class="docutils literal notranslate"><span class="pre">scylla</span></code> and not another user. Run the
following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo -u scylla /usr/bin/scylla local-file-key-generator &lt;op&gt; [options] [key-path]
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span></code> is either <code class="docutils literal notranslate"><span class="pre">generate</span></code> or <code class="docutils literal notranslate"><span class="pre">append</span></code>. <code class="docutils literal notranslate"><span class="pre">generate</span></code> creates a
new key file with the generated key, while <code class="docutils literal notranslate"><span class="pre">append</span></code> appends a new
key of the required type to an existing key file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[options]</span></code> can be any combination of the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-a,--alg</span> <span class="pre">&lt;arg&gt;</span></code> - the encryption algorithm (e.g., AES) you want to use to encrypt the key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-h,--help</span></code> - displays the help menu</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l,--length</span> <span class="pre">&lt;arg&gt;</span></code> - the length of the encryption key in bits (i.e. 128, 256)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b,--block-mode</span> <span class="pre">&lt;arg&gt;</span></code> - the encryption algorithm block mode (i.e. CBC, EBC)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p,--padding</span> <span class="pre">&lt;arg&gt;</span></code> - the encryption algorithm padding method (i.e. PKCS5)</p></li>
</ul>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">[key-path]</span></code> - is the directory you want to place the key into</dt><dd><p>(e.g., <code class="docutils literal notranslate"><span class="pre">/etc/scylla/encryption_keys</span></code>). This is optional for
<code class="docutils literal notranslate"><span class="pre">append</span></code> if the file already exists.</p>
</dd>
</dl>
</li>
</ul>
<p>For example:</p>
<p>To create a secret key and a system key in a different location:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo -u scylla /usr/bin/scylla local-file-key-generator generate -a AES -b CBC -p PKCS5 -l 128 ${SCYLLA_LOCAL_KEYS_DIR?}/secret_key
sudo -u scylla /usr/bin/scylla local-file-key-generator generate -a AES -b CBC -p PKCS5 -l 128 ${SCYLLA_LOCAL_KEYS_DIR?}/system_keys/system_key
</pre></div>
</div>
</li>
<li><p>Verify that the script has successfully created the key in your
selected location.</p>
<p>To display the secret key parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo -u scylla cat ${SCYLLA_LOCAL_KEYS_DIR?}/secret_key
</pre></div>
</div>
<p>To display the system key parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo -u scylla cat ${SCYLLA_LOCAL_KEYS_DIR?}/system_keys/system_key
</pre></div>
</div>
<p>Both commands should return a single line with the following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;cipher_algorithm&gt;:&lt;secret_key_length&gt;:&lt;base64encoded_key&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>AES/CBC/PKCS5Padding:128:8stVxW5ypYhNxsnRVS1A6suKhk0sG4Tj
</pre></div>
</div>
</li>
<li><p>Securely copy the key file, using <code class="docutils literal notranslate"><span class="pre">scp</span></code> or similar, to the same path
on all nodes in the cluster. Make sure the key on each target node is
moved to the same location as the source directory and that the target
directory has the same permissions as the source directory.</p></li>
</ol>
</div><div aria-labelledby="tab-0-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The Replicated Key Provider requires two additional keys:</p>
<ul class="simple">
<li><p>A system key - used to encrypt the data in the system table.</p></li>
<li><p>A local secret key - used as a fallback key, in case the Replicated Key
Provider fails to retrieve a key from the system table.</p></li>
</ul>
<p>The system key can be either a local key, or a KMIP key. In either case,
you have to provide your own key (Scylla will not generate it). Check the
instructions in the relevant tabs on how to create such keys.</p>
<p>The local secret key can be created using the same method as the system
key, but it is also possible to let ScyllaDB generate it for you, in the
path that you specified in the <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You cannot use the same key for both the system key and the local
secret key. They must be different keys.</p>
</div>
</div><div aria-labelledby="tab-0-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The KMIP Key Provider will first try to discover existing keys in the KMIP
server, and if it does not find any, it will generate new keys. The key
discovery is based on attributes. If you wish to provide your own keys,
make sure to set the following attributes so that the KMIP Key Provider
can locate them:</p>
<ul class="simple">
<li><p>Object type: symmetric key</p></li>
<li><p>Algorithm: your desired algorithm (e.g., AES)</p></li>
<li><p>Key size: your desired key size (e.g., 128 bits)</p></li>
<li><p>State: active</p></li>
<li><p>Cryptographic Usage Mask: Encrypt, Decrypt</p></li>
<li><p>(optional) Key namespace: a namespace for your key(s), - must match the
<code class="docutils literal notranslate"><span class="pre">key_namespace</span></code> option that you will specify in the
<code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> in the table schema</p></li>
</ul>
</div><div aria-labelledby="tab-0-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><p>To use the KMS Key Provider, you must generate a key yourself in your AWS
account. The key must be a symmetric key, using the <code class="docutils literal notranslate"><span class="pre">SYMMETRIC_DEFAULT</span></code>
key spec. If your key is regional, consider creating it in the same region
as your ScyllaDB cluster.</p>
<p>For step-by-step instructions, refer to the <a class="reference external" href="https://docs.aws.amazon.com/kms/latest/developerguide/create-symmetric-cmk.html">AWS documentation</a>.</p>
</div><div aria-labelledby="tab-0-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><p>To use the GCP Key Provider, you must generate a key ring and a key in
your GCP account. The key must be a symmetric key with the
<code class="docutils literal notranslate"><span class="pre">ENCRYPT_DECRYPT</span></code> purpose. Consider creating your key ring in the same
location as your ScyllaDB cluster.</p>
<p>For step-by-step instructions, refer to the GCP documentation for <a class="reference external" href="https://cloud.google.com/kms/docs/create-key-ring">creating
a key ring</a> and
<a class="reference external" href="https://cloud.google.com/kms/docs/create-key">creating a key</a>.</p>
</div><div aria-labelledby="tab-0-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><p>To use the Azure Key Provider, you must create a key vault and a key in
your Azure account. The key must be an RSA key with either software or HSM
protection, and it must permit the <code class="docutils literal notranslate"><span class="pre">wrapkey</span></code> and <code class="docutils literal notranslate"><span class="pre">unwrapkey</span></code> operations.
Consider creating your vault in the same location as your ScyllaDB cluster.</p>
<p>For step-by-step instructions, refer to the Azure documentation for <a class="reference external" href="https://docs.microsoft.com/en-us/azure/key-vault/general/quick-create-portal">creating
a key vault</a>
and <a class="reference external" href="https://learn.microsoft.com/en-us/azure/key-vault/keys/quick-create-portal">generating a key</a>.</p>
</div></div>
</section>
<section id="set-the-kmip-host">
<span id="encryption-at-rest-set-kmip"></span><h2>Set the KMIP Host<a class="headerlink" href="#set-the-kmip-host" title="Link to this heading">¶</a></h2>
<p>If you are using <a class="reference internal" href="../../reference/glossary.html#term-Key-Management-Interoperability-Protocol-KMIP"><span class="xref std std-term">KMIP</span></a>
to encrypt tables or system information, add the KMIP server information to the
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> configuration file.</p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> and add the
following in KMIP host(s) section:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">kmip_hosts</span><span class="p">:</span>
<span class="w">   </span><span class="nt">&lt;name&gt;</span><span class="p">:</span>
<span class="w">       </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;address1[:port]&gt; [, &lt;address2[:port]&gt;...]</span>
<span class="w">       </span><span class="nt">certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;identifying certificate&gt; (optional)</span>
<span class="w">       </span><span class="nt">keyfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;identifying key&gt; (optional; it is required if &quot;certificate&quot; is set)</span>
<span class="w">       </span><span class="nt">truststore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;truststore for SSL connection&gt; (optional)</span>
<span class="w">       </span><span class="nt">priority_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;kmip tls priority string&gt;</span>
<span class="w">       </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;login&gt; (optional)</span>
<span class="w">       </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;password&gt; (optional)</span>
<span class="w">       </span><span class="nt">max_command_retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;int&gt; (optional; default 3)</span>
<span class="w">       </span><span class="nt">key_cache_expiry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache expiry period&gt;</span>
<span class="w">       </span><span class="nt">key_cache_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache refresh/prune period&gt;</span>
<span class="c1">#   &lt;name&gt;:</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> - The cluster name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hosts</span></code> - The list of hosts specified by IP and port for the KMIP server.
The KMIP connection management only supports failover, so all requests go
through a single KMIP server. There is no load balancing, as currently no
KMIP servers support read replication or other strategies for availability.
Hosts are tried in the order they appear, and the next one in the list is
tried if the previous one fails. The default number of retries is three,
but you can customize it with <code class="docutils literal notranslate"><span class="pre">max_command_retries</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">certificate</span></code> - The name of the certificate and path used to identify yourself to the KMIP server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyfile</span></code> - The name of the key used to identify yourself to the KMIP server. It is generated together with the certificate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">truststore</span></code> - The location and key for the truststore to present to the KMIP server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority_string</span></code> - The KMIP TLS priority string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code> - The KMIP server user name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code> - The KMIP server password.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_command_retries</span></code> - The number of attempts to connect to the KMIP server before trying the next host in the list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> - Key cache expiry period, after which keys will be re-requested from server. Default is 30s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_refresh</span></code> - Key cache refresh period - the frequency at which cache is checked for expired entries. Default is 100s.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kmip_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-kmip1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1:5696</span>
<span class="w">      </span><span class="nt">certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kmip/cert.pem</span>
<span class="w">      </span><span class="nt">keyfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kmip/key.pem</span>
</pre></div>
</div>
</li>
<li><p>Save the file.</p></li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-1-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-1-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-1-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-1-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ol>
</section>
<section id="set-the-kms-host">
<span id="encryption-at-rest-set-kms"></span><h2>Set the KMS Host<a class="headerlink" href="#set-the-kms-host" title="Link to this heading">¶</a></h2>
<p>If you are using AWS KMS to encrypt tables or system information, you need to
add the KMS host information to the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> configuration file.</p>
<p><strong>Before you Begin</strong></p>
<p>Before configuring AWS KMS integration, ensure you have:</p>
<ul class="simple">
<li><p>An AWS KMS key in your AWS account. Follow the procedure in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create
Encryption Keys</span></a> to create it.</p></li>
<li><p>Credentials to authenticate ScyllaDB against the KMS key. Choose one of:</p>
<ul>
<li><p><strong>EC2 instance role</strong> (recommended for production) - ScyllaDB will use the IAM role attached to the EC2 instance.</p></li>
<li><p><strong>IAM role</strong> (recommended for production) - ScyllaDB will use the provided credentials to assume an IAM role. It allows to grant temporary, limited access to resources.</p></li>
<li><p><strong>IAM user</strong> - You will need to supply long-term credentials for this user.</p></li>
<li><p><strong>AWS profile</strong> - A profile configured via the AWS CLI.</p></li>
</ul>
</li>
<li><p>Sufficient permissions on the KMS key to perform the <code class="docutils literal notranslate"><span class="pre">DescribeKey</span></code>,
<code class="docutils literal notranslate"><span class="pre">GenerateDataKey</span></code> and <code class="docutils literal notranslate"><span class="pre">Decrypt</span></code> operations on the KMS key.</p></li>
</ul>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> to add the
following in KMS host(s) section:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">kms_hosts</span><span class="p">:</span>
<span class="w">   </span><span class="nt">&lt;name&gt;</span><span class="p">:</span>
<span class="w">       </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http(s)://&lt;host&gt;(:port) (optional if `aws_region` is specified)</span>
<span class="w">       </span><span class="nt">aws_region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;aws region&gt; (optional if `endpoint` is specified)</span>
<span class="w">       </span><span class="nt">aws_access_key_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;aws access key id&gt; (optional)</span>
<span class="w">       </span><span class="nt">aws_secret_access_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;aws secret access key&gt; (optional)</span>
<span class="w">       </span><span class="nt">aws_session_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;aws session token&gt; (optional)</span>
<span class="w">       </span><span class="nt">aws_profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;aws credentials profile to use&gt; (optional)</span>
<span class="w">       </span><span class="nt">aws_use_ec2_credentials: (bool </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default false)</span>
<span class="w">       </span><span class="nt">aws_use_ec2_region: (bool </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default false)</span>
<span class="w">       </span><span class="nt">aws_assume_role_arn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;arn of aws role to assume before call&gt; (optional)</span>
<span class="w">       </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;named KMS key for encrypting data keys&gt; (required)</span>
<span class="w">       </span><span class="nt">certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;identifying certificate&gt; (optional)</span>
<span class="w">       </span><span class="nt">keyfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;identifying key&gt; (optional)</span>
<span class="w">       </span><span class="nt">truststore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;truststore for SSL connection&gt; (optional)</span>
<span class="w">       </span><span class="nt">priority_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;KMS TLS priority string&gt; (optional)</span>
<span class="w">       </span><span class="nt">key_cache_expiry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache expiry period&gt;</span>
<span class="w">       </span><span class="nt">key_cache_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache refresh/prune period&gt;</span>
<span class="c1">#   &lt;name&gt;:</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> - The name to identify the KMS host. You have to provide this name to encrypt a <a class="reference internal" href="#ear-create-table"><span class="std std-ref">new</span></a> or <a class="reference internal" href="#ear-alter-table"><span class="std std-ref">existing</span></a> table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code> - The explicit KMS host endpoint. If not provided, <code class="docutils literal notranslate"><span class="pre">aws_region</span></code> is used for connection.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code> - An AWS region. If not provided, <code class="docutils literal notranslate"><span class="pre">endpoint</span></code> is used for connection.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_access_key_id</span></code> - AWS access key used for authentication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_secret_access_key</span></code> - AWS secret access key used for authentication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_session_token</span></code> - AWS session token. Used for authentication with temporary security credentials, along with access key id and secret access key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_profile</span></code> - AWS profile to use when reading credentials from the <code class="docutils literal notranslate"><span class="pre">~/.aws/credentials</span></code> file. If not provided, the value is read from the
<code class="docutils literal notranslate"><span class="pre">AWS_PROFILE</span></code> environment variable. If neither is defined, it defaults to <code class="docutils literal notranslate"><span class="pre">default</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_use_ec2_credentials</span></code> - If true, KMS queries will use the credentials provided by ec2 instance role metadata as initial access key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_use_ec2_region</span></code> - If true, KMS queries will use the AWS region indicated by ec2 instance metadata.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_assume_role_arn</span></code> - If set, any KMS query will first attempt to assume this role.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The ID or alias of your AWS KMS key. The key must be generated with an appropriate access policy so that the AWS user has permissions to
read the key and encrypt data using that key. This parameter is required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">certificate</span></code> - The name of the certificate and the path used to identify yourself to the KMS server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyfile</span></code> - The name of the key for the certificate. It is generated together with the certificate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">truststore</span></code> - The location and key for the truststore to present to the KMS server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority_string</span></code> - The KMS TLS priority string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> - Key cache expiry period, after which keys will be re-requested from server. Default is 600s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_refresh</span></code> - Key cache refresh period - the frequency at which cache is checked for expired entries. Default is 1200s.</p></li>
</ul>
<p>Examples:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-RUMyIGluc3RhbmNlIHJvbGUgKHJlY29tbWVuZGVkKQ==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-RUMyIGluc3RhbmNlIHJvbGUgKHJlY29tbWVuZGVkKQ==" name="RUMyIGluc3RhbmNlIHJvbGUgKHJlY29tbWVuZGVkKQ==" role="tab" tabindex="0">EC2 instance role (recommended)</button><button aria-controls="panel-2-SUFNIHJvbGUgKHJlY29tbWVuZGVkKQ==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-SUFNIHJvbGUgKHJlY29tbWVuZGVkKQ==" name="SUFNIHJvbGUgKHJlY29tbWVuZGVkKQ==" role="tab" tabindex="-1">IAM role (recommended)</button><button aria-controls="panel-2-SUFNIHVzZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-SUFNIHVzZXI=" name="SUFNIHVzZXI=" role="tab" tabindex="-1">IAM user</button><button aria-controls="panel-2-QVdTIHByb2ZpbGU=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-QVdTIHByb2ZpbGU=" name="QVdTIHByb2ZpbGU=" role="tab" tabindex="-1">AWS profile</button></div><div aria-labelledby="tab-2-RUMyIGluc3RhbmNlIHJvbGUgKHJlY29tbWVuZGVkKQ==" class="sphinx-tabs-panel group-tab" id="panel-2-RUMyIGluc3RhbmNlIHJvbGUgKHJlY29tbWVuZGVkKQ==" name="RUMyIGluc3RhbmNlIHJvbGUgKHJlY29tbWVuZGVkKQ==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kms_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-kms1</span><span class="p">:</span>
<span class="w">     </span><span class="nt">aws_use_ec2_credentials</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">     </span><span class="nt">aws_use_ec2_region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">     </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myorg/MyKey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-SUFNIHJvbGUgKHJlY29tbWVuZGVkKQ==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-SUFNIHJvbGUgKHJlY29tbWVuZGVkKQ==" name="SUFNIHJvbGUgKHJlY29tbWVuZGVkKQ==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kms_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-kms1</span><span class="p">:</span>
<span class="w">     </span><span class="nt">aws_use_ec2_credentials</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">     </span><span class="nt">aws_use_ec2_region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">     </span><span class="nt">aws_assume_role_arn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::123456789012:role/ScyllaDBKMSRole</span>
<span class="w">     </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myorg/MyKey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-SUFNIHVzZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-SUFNIHVzZXI=" name="SUFNIHVzZXI=" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kms_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-kms1</span><span class="p">:</span>
<span class="w">     </span><span class="nt">aws_region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
<span class="w">     </span><span class="nt">aws_access_key_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">THISISANACCESSKEYID</span>
<span class="w">     </span><span class="nt">aws_secret_access_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">THISISASECRETACCESSKEY</span>
<span class="w">     </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myorg/MyKey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-QVdTIHByb2ZpbGU=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-QVdTIHByb2ZpbGU=" name="QVdTIHByb2ZpbGU=" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kms_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-kms1</span><span class="p">:</span>
<span class="w">     </span><span class="nt">aws_region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
<span class="w">     </span><span class="nt">aws_profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span>
<span class="w">     </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myorg/MyKey</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that either <code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">aws_region</span></code> or <code class="docutils literal notranslate"><span class="pre">aws_use_ec2_region</span></code>
must be set (one of them is required for connection).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AWS Credential Resolution</strong></p>
<p>If the <code class="docutils literal notranslate"><span class="pre">aws_use_ec2_credentials</span></code> option is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, and no
explicit credentials have been provided (i.e., any of the
<code class="docutils literal notranslate"><span class="pre">aws_access_key_id</span></code> and <code class="docutils literal notranslate"><span class="pre">aws_secret_access_key</span></code> options is missing),
ScyllaDB will attempt to automatically resolve credentials in the
following order:</p>
<ol class="arabic simple">
<li><p><strong>Environment Variables</strong>: Checks the <code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code> and
<code class="docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code> environment variables. If set, ScyllaDB uses
these credentials directly.</p></li>
<li><p><strong>AWS Profile</strong>: Reads credentials from the AWS credentials file
(<code class="docutils literal notranslate"><span class="pre">~/.aws/credentials</span></code>) using:</p>
<ul class="simple">
<li><p>The profile specified by the <code class="docutils literal notranslate"><span class="pre">aws_profile</span></code> option in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">aws_profile</span></code> is not set, uses the profile from the <code class="docutils literal notranslate"><span class="pre">AWS_PROFILE</span></code>
environment variable.</p></li>
<li><p>If neither is defined, defaults to the <code class="docutils literal notranslate"><span class="pre">default</span></code> profile.</p></li>
</ul>
</li>
</ol>
</div>
</li>
<li><p>Save the file.</p></li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-3-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-3-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-3-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-3-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ol>
</section>
<section id="set-the-gcp-host">
<span id="encryption-at-rest-set-gcp"></span><h2>Set the GCP Host<a class="headerlink" href="#set-the-gcp-host" title="Link to this heading">¶</a></h2>
<p>If you are using GCP Cloud KMS to encrypt tables or system information, you need
to add the GCP host information to the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> configuration file.</p>
<p><strong>Before you Begin</strong></p>
<p>Before configuring GCP KMS integration, ensure you have:</p>
<ul class="simple">
<li><p>A GCP KMS key ring and key in your GCP account. Follow the procedure in
<a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a> to create them.</p></li>
<li><p>Credentials to authenticate ScyllaDB against the KMS key. Choose one of:</p>
<ul>
<li><p><strong>Attached service account</strong> (recommended for production) - ScyllaDB will use the service account attached to the VM instance.</p></li>
<li><p><strong>Impersonated service account</strong> (recommended for production) - ScyllaDB will use the provided credentials to impersonate a service account. It allows to
grant temporary, limited access to resources.</p></li>
<li><p><strong>Application default credentials</strong> - <a class="reference external" href="https://cloud.google.com/docs/authentication/application-default-credentials">A credential file</a> configured via the
gcloud CLI.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">roles/cloudkms.cryptoKeyEncrypterDecrypter</span></code> role assigned to the identity of your choice.</p></li>
</ul>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> to add the
following in KMS host(s) section:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">gcp_hosts</span><span class="p">:</span>
<span class="w">   </span><span class="nt">&lt;name&gt;</span><span class="p">:</span>
<span class="w">       </span><span class="nt">gcp_project_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;gcp project&gt;</span>
<span class="w">       </span><span class="nt">gcp_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;gcp location&gt;</span>
<span class="w">       </span><span class="nt">gcp_credentials_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;(service) account json key file - authentication&gt;</span>
<span class="w">       </span><span class="nt">gcp_impersonate_service_account</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;service account to impersonate&gt;</span>
<span class="w">       </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;keyring&gt;/&lt;keyname&gt; - named GCP key for encrypting data keys (required)</span>
<span class="w">       </span><span class="nt">certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;identifying certificate&gt; (optional)</span>
<span class="w">       </span><span class="nt">keyfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;identifying key&gt; (optional)</span>
<span class="w">       </span><span class="nt">truststore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;truststore for SSL connection&gt; (optional)</span>
<span class="w">       </span><span class="nt">priority_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;KMS TLS priority string&gt; (optional)</span>
<span class="w">       </span><span class="nt">key_cache_expiry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache expiry period&gt;</span>
<span class="w">       </span><span class="nt">key_cache_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache refresh/prune period&gt;</span>
<span class="c1">#   &lt;name&gt;:</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> - The name to identify the GCP host. You have to provide this name to encrypt a <a class="reference internal" href="#ear-create-table"><span class="std std-ref">new</span></a> or <a class="reference internal" href="#ear-alter-table"><span class="std std-ref">existing</span></a> table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_project_id</span></code> - The GCP project from which to retrieve key information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_location</span></code> - A GCP project location.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_credentials_file</span></code> - GCP credentials file used for authentication. If not specified, the provider reads it from your GCP credentials.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_impersonate_service_account</span></code> - An optional service account to impersonate when issuing key query calls.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The &lt;keyring&gt;/&lt;keyname&gt; of your GCP KMS key. The key must be generated with an appropriate IAM policy so that the identity has permissions
to encrypt and decrypt data using that key. This parameter is required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">certificate</span></code> - The name of the certificate and the path used to identify yourself to the KMS server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyfile</span></code> - The name of the key for the certificate. It is generated together with the certificate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">truststore</span></code> - The location and key for the truststore to present to the KMS server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority_string</span></code> - The KMS TLS priority string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> - Key cache expiry period, after which keys will be re-requested from server. Default is 600s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_refresh</span></code> - Key cache refresh period - the frequency at which cache is checked for expired entries. Default is 1200s.</p></li>
</ul>
<p>Examples:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-QXR0YWNoZWQgc2VydmljZSBhY2NvdW50IChyZWNvbW1lbmRlZCk=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-QXR0YWNoZWQgc2VydmljZSBhY2NvdW50IChyZWNvbW1lbmRlZCk=" name="QXR0YWNoZWQgc2VydmljZSBhY2NvdW50IChyZWNvbW1lbmRlZCk=" role="tab" tabindex="0">Attached service account (recommended)</button><button aria-controls="panel-4-SW1wZXJzb25hdGVkIHNlcnZpY2UgYWNjb3VudCAocmVjb21tZW5kZWQp" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-SW1wZXJzb25hdGVkIHNlcnZpY2UgYWNjb3VudCAocmVjb21tZW5kZWQp" name="SW1wZXJzb25hdGVkIHNlcnZpY2UgYWNjb3VudCAocmVjb21tZW5kZWQp" role="tab" tabindex="-1">Impersonated service account (recommended)</button><button aria-controls="panel-4-QXBwbGljYXRpb24gZGVmYXVsdCBjcmVkZW50aWFscw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-QXBwbGljYXRpb24gZGVmYXVsdCBjcmVkZW50aWFscw==" name="QXBwbGljYXRpb24gZGVmYXVsdCBjcmVkZW50aWFscw==" role="tab" tabindex="-1">Application default credentials</button></div><div aria-labelledby="tab-4-QXR0YWNoZWQgc2VydmljZSBhY2NvdW50IChyZWNvbW1lbmRlZCk=" class="sphinx-tabs-panel group-tab" id="panel-4-QXR0YWNoZWQgc2VydmljZSBhY2NvdW50IChyZWNvbW1lbmRlZCk=" name="QXR0YWNoZWQgc2VydmljZSBhY2NvdW50IChyZWNvbW1lbmRlZCk=" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">gcp_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-gcp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">gcp_project_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myproject</span>
<span class="w">      </span><span class="nt">gcp_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mykeyring/mykey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-SW1wZXJzb25hdGVkIHNlcnZpY2UgYWNjb3VudCAocmVjb21tZW5kZWQp" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-SW1wZXJzb25hdGVkIHNlcnZpY2UgYWNjb3VudCAocmVjb21tZW5kZWQp" name="SW1wZXJzb25hdGVkIHNlcnZpY2UgYWNjb3VudCAocmVjb21tZW5kZWQp" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">gcp_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-gcp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">gcp_project_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myproject</span>
<span class="w">      </span><span class="nt">gcp_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">gcp_impersonate_service_account</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-service-account@myproject.iam.gserviceaccount.com</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mykeyring/mykey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-QXBwbGljYXRpb24gZGVmYXVsdCBjcmVkZW50aWFscw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-QXBwbGljYXRpb24gZGVmYXVsdCBjcmVkZW50aWFscw==" name="QXBwbGljYXRpb24gZGVmYXVsdCBjcmVkZW50aWFscw==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">gcp_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-gcp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">gcp_project_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myproject</span>
<span class="w">      </span><span class="nt">gcp_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">gcp_credentials_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/user/.config/gcloud/application_default_credentials.json</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mykeyring/mykey</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>GCP Credential Resolution</strong></p>
<p>If the <code class="docutils literal notranslate"><span class="pre">gcp_credentials_file</span></code> option is not specified in the
configuration,  ScyllaDB follows Google’s Application Default Credentials
(ADC) pattern to automatically resolve credentials in the following order:</p>
<ol class="arabic">
<li><p><strong>Environment Variable</strong>: Checks the <code class="docutils literal notranslate"><span class="pre">GOOGLE_APPLICATION_CREDENTIALS</span></code>
environment variable. If set, ScyllaDB loads credentials from the
specified file path.</p></li>
<li><p><strong>Well-Known File Locations</strong>: Looks for credentials in standard gcloud
SDK locations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">~/{CLOUDSDK_CONFIG}/application_default_credentials.json</span></code> (if <code class="docutils literal notranslate"><span class="pre">CLOUDSDK_CONFIG</span></code>  environment variable is set)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.config/gcloud/application_default_credentials.json</span></code> (default location)</p></li>
</ul>
</li>
<li><p><strong>Metadata Server</strong>: Attempts to detect if running on a Google Compute
Engine (GCE) instance by:</p>
<ul class="simple">
<li><p>Querying the metadata server (<code class="docutils literal notranslate"><span class="pre">metadata.google.internal</span></code> or the host
specified in <code class="docutils literal notranslate"><span class="pre">GCE_METADATA_HOST</span></code> environment variable).</p></li>
<li><p>Checking for “Google” in <code class="docutils literal notranslate"><span class="pre">/sys/class/dmi/id/product_name</span></code>.</p></li>
</ul>
<p>If running on GCE, it uses the metadata server to obtain credentials
for the service account attached to the VM instance.</p>
</li>
</ol>
</div>
</li>
<li><p>Save the file.</p></li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-5-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-5-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-5-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-5-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ol>
</section>
<section id="set-the-azure-host">
<span id="encryption-at-rest-set-azure"></span><h2>Set the Azure Host<a class="headerlink" href="#set-the-azure-host" title="Link to this heading">¶</a></h2>
<p>If you are using Azure Key Vault to encrypt tables or system information, you
need to add the Azure information to the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> configuration file.</p>
<p><strong>Before you Begin</strong></p>
<p>Before configuring Azure Key Vault integration, ensure you have:</p>
<ul class="simple">
<li><p>A key vault and a key in your Azure account. Follow the procedure in
<a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a> to create them.</p></li>
<li><p>An Azure identity to authenticate ScyllaDB against the Vault key. Choose one of:</p>
<ul>
<li><p><strong>Managed Identity</strong> (recommended for production) - No credentials are needed. ScyllaDB will automatically detect and use the default managed identity of the Azure VM.</p></li>
<li><p><strong>Service Principal</strong> - Requires providing a tenant ID, client ID, and a secret or certificate.</p></li>
</ul>
</li>
<li><p>Sufficient permissions to perform the <code class="docutils literal notranslate"><span class="pre">wrapkey</span></code> and <code class="docutils literal notranslate"><span class="pre">unwrapkey</span></code> operations
on the key. For example, if your key vault uses RBAC, you can assign the
built-in “Key Vault Crypto User” role to your identity.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ScyllaDB can also authenticate indirectly through a preconfigured Azure CLI,
but this is offered only for testing purposes.</p>
</div>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> to add the
following in the Azure host(s) section:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">azure_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span><span class="p">:</span>
<span class="w">      </span><span class="nt">azure_tenant_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;tenant ID&gt; (optional)</span>
<span class="w">      </span><span class="nt">azure_client_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ID of the service principal&gt; (optional)</span>
<span class="w">      </span><span class="nt">azure_client_secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;secret of the service principal&gt; (optional)</span>
<span class="w">      </span><span class="nt">azure_client_certificate_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path to PEM-encoded certificate and private key of the service principal&gt; (optional)</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;vaultname&gt;/&lt;keyname&gt; - named Vault key for encrypting data keys (required)</span>
<span class="w">      </span><span class="nt">truststore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PEM file with CA certificates for TLS&gt; (optional)</span>
<span class="w">      </span><span class="nt">priority_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;TLS priority string&gt; (optional)</span>
<span class="w">      </span><span class="nt">key_cache_expiry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache expiry period&gt; (optional)</span>
<span class="w">      </span><span class="nt">key_cache_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;key cache refresh/prune period&gt; (optional)</span>
<span class="c1">#   &lt;name&gt;:</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> - The name to identify the Azure host. You have to provide this name to encrypt a <a class="reference internal" href="#ear-create-table"><span class="std std-ref">new</span></a> or <a class="reference internal" href="#ear-alter-table"><span class="std std-ref">existing</span></a> table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_tenant_id</span></code> - The ID of the Azure tenant. Required only for authentication with a service principal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_client_id</span></code> - The client ID of your service principal. Required only for authentication with a service principal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_client_secret</span></code> - The secret of your service principal. Required only for authentication with a service principal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_client_certificate_path</span></code> - The path to the PEM-encoded certificate and private key file of your service principal. Can be used instead of a secret.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The &lt;vaultname&gt;/&lt;keyname&gt; of your key. This parameter is required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">truststore</span></code> - Path to a PEM file with CA certificates to validate the server’s TLS certificate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority_string</span></code> - The TLS priority string for TLS handshakes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> - Key cache expiry period, after which keys will be re-requested from Azure Key Vault. Default is 600s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_cache_refresh</span></code> - Key cache refresh period - the frequency at which the cache is checked for expired entries. Default is 1200s.</p></li>
</ul>
<p>Example:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-TWFuYWdlZCBJZGVudGl0eSAocmVjb21tZW5kZWQp" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-TWFuYWdlZCBJZGVudGl0eSAocmVjb21tZW5kZWQp" name="TWFuYWdlZCBJZGVudGl0eSAocmVjb21tZW5kZWQp" role="tab" tabindex="0">Managed Identity (recommended)</button><button aria-controls="panel-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBTZWNyZXQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBTZWNyZXQ=" name="U2VydmljZSBQcmluY2lwYWwgd2l0aCBTZWNyZXQ=" role="tab" tabindex="-1">Service Principal with Secret</button><button aria-controls="panel-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBDZXJ0aWZpY2F0ZQ==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBDZXJ0aWZpY2F0ZQ==" name="U2VydmljZSBQcmluY2lwYWwgd2l0aCBDZXJ0aWZpY2F0ZQ==" role="tab" tabindex="-1">Service Principal with Certificate</button></div><div aria-labelledby="tab-6-TWFuYWdlZCBJZGVudGl0eSAocmVjb21tZW5kZWQp" class="sphinx-tabs-panel group-tab" id="panel-6-TWFuYWdlZCBJZGVudGl0eSAocmVjb21tZW5kZWQp" name="TWFuYWdlZCBJZGVudGl0eSAocmVjb21tZW5kZWQp" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">azure_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-azure1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mykeyvault/mykey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBTZWNyZXQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBTZWNyZXQ=" name="U2VydmljZSBQcmluY2lwYWwgd2l0aCBTZWNyZXQ=" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">azure_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-azure1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">azure_tenant_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">00000000-1111-2222-3333-444444444444</span>
<span class="w">      </span><span class="nt">azure_client_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">55555555-6666-7777-8888-999999999999</span>
<span class="w">      </span><span class="nt">azure_client_secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mykeyvault/mykey</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBDZXJ0aWZpY2F0ZQ==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-U2VydmljZSBQcmluY2lwYWwgd2l0aCBDZXJ0aWZpY2F0ZQ==" name="U2VydmljZSBQcmluY2lwYWwgd2l0aCBDZXJ0aWZpY2F0ZQ==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">azure_hosts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my-azure1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">azure_tenant_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">00000000-1111-2222-3333-444444444444</span>
<span class="w">      </span><span class="nt">azure_client_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">55555555-6666-7777-8888-999999999999</span>
<span class="w">      </span><span class="nt">azure_client_certificate_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/certificate.pem</span>
<span class="w">      </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mykeyvault/mykey</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Azure Credential Resolution</strong></p>
<p>If no credentials are provided in the configuration file, ScyllaDB will
attempt to automatically resolve credentials in the following order:</p>
<ol class="arabic simple">
<li><p><strong>Environment Variables</strong>: Checks the <code class="docutils literal notranslate"><span class="pre">AZURE_TENANT_ID</span></code>,
<code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_ID</span></code>, <code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_SECRET</span></code>, and
<code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_CERTIFICATE_PATH</span></code> environment variables. If set,
ScyllaDB uses these credentials directly. If both <code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_SECRET</span></code>
and <code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_CERTIFICATE_PATH</span></code> are set, the secret takes
precedence.</p></li>
<li><p><strong>Azure CLI</strong>: If the Azure CLI is installed and configured, ScyllaDB
will be using it to generate access tokens.</p></li>
<li><p><strong>Azure Instance Metadata Service (IMDS)</strong>: If running on an Azure VM
with an assigned managed identity, ScyllaDB will be querying the IMDS
for access tokens.</p></li>
</ol>
</div>
</li>
<li><p>Save the file.</p></li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a></p></li>
<li><p>Restart the scylla-server service.</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-7-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-7-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-7-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-7-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</section>
<section id="encrypt-tables">
<h2>Encrypt Tables<a class="headerlink" href="#encrypt-tables" title="Link to this heading">¶</a></h2>
<p>ScyllaDB allows you to enable or disable default encryption of tables on a
particular node. When enabled, the tables on this node will be encrypted by
default using the configuration provided for the <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> option
in the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can override the default configuration when you CREATE TABLE or ALTER TABLE
with <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code>. See <a class="reference internal" href="#ear-create-table"><span class="std std-ref">Encrypt a Single Table</span></a> for details.</p>
</div>
<p><strong>Before you Begin</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-8-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-8-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-8-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-8-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-8-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-8-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-8-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><ul>
<li><p>If you want to create your own key(s), follow the procedure in
<a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a>.</p></li>
<li><p>If you want to let Scylla create the key(s) for you, run the following
commands to configure a directory for your keys (the default location
<code class="docutils literal notranslate"><span class="pre">/etc/scylla/data_encryption_keys</span></code> may cause permission issues; the
following example selects the <code class="docutils literal notranslate"><span class="pre">/etc/scylla/encryption_keys</span></code> directory
for your keys):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /etc/scylla/encryption_keys
sudo chown -R scylla:scylla /etc/scylla/encryption_keys
sudo chmod -R 700 /etc/scylla/encryption_keys
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-8-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The Replicated Key Provider cannot be used in <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code>.
You can only use it to <a class="reference internal" href="#ear-create-table"><span class="std std-ref">Encrypt a Single Table</span></a>.</p>
</div><div aria-labelledby="tab-8-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">set up a KMIP Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-8-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">set up a KMS Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-8-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">set up a GCP Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-8-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">set up an Azure Host</span></a>.</p></li>
</ul>
</div></div>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> and configure the
<code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> section based on your key provider:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-9-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-9-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-9-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-9-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-9-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-9-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-9-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_key_directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path to system key directory&gt;</span>

<span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">secret_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;secret key file&gt;</span>
<span class="w">  </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;system key name&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables default table encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> - Full path to the secret key file created by you in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a> or that will be
created by Scylla. If set, Scylla will load the key directly from this location. Defaults to <code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system/&lt;key_name&gt;</span></code> when not
provided.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_name</span></code> (optional) - Base name of the system key file. Scylla constructs the path as <code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system/&lt;key_name&gt;</span></code>. Only used if
<code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> is <strong>not</strong> specified. Defaults to <code class="docutils literal notranslate"><span class="pre">system_table_keytab</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system_key_directory</span></code> (optional) - Directory that contains system key files. Used only when <code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> is <strong>not</strong> set to locate
<code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system/&lt;key_name&gt;</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">/etc/scylla/conf/resources/system_keys/</span></code>.</p></li>
</ul>
<p><strong>Example with secret key file:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">secret_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/scylla/encryption_keys/secret_key</span>
</pre></div>
</div>
<p><strong>Example with key name:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_key_directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/scylla/encryption_keys/system_keys</span>

<span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_key</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The Replicated Key Provider cannot be used in <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code>.
You can only use it to <a class="reference internal" href="#ear-create-table"><span class="std std-ref">Encrypt a Single Table</span></a>.</p>
</div><div aria-labelledby="tab-9-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmipKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kmip_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your kmip_host&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables default table encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kmip_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">kmip_host</span></a> group.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmipKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kmip_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-kmip1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmsKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kms_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your kms_host&gt;</span>
<span class="w">  </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;AWS KMS key to override the one configured in kms_host&gt; (optional)</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables default table encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kms_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">kms_host</span></a> group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The ID or alias of an AWS KMS key. It allows you to specify a different key than the one configured in the <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">kms_host</span></a>. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmsKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kms_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-kms1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GcpKeyProviderFactory</span>
<span class="w">  </span><span class="nt">gcp_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your gcp_host&gt;</span>
<span class="w">  </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;GCP KMS key to override the one configured in gcp_host&gt; (optional)</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables default table encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">gcp_host</span></a> group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The &lt;keyring&gt;/&lt;keyname&gt; of a GCP KMS key. It allows you to specify a different key than the one configured in the <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">gcp_host</span></a>. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GcpKeyProviderFactory</span>
<span class="w">  </span><span class="nt">gcp_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-gcp1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureKeyProviderFactory</span>
<span class="w">  </span><span class="nt">azure_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your azure_host&gt;</span>
<span class="w">  </span><span class="nt">master_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;Azure Vault key to override the one configured in azure_host&gt; (optional)</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables default table encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">azure_host</span></a> group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The &lt;vaultname&gt;/&lt;keyname&gt; of an Azure Key Vault key. It allows you to specify a different key than the one configured in the
<a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">azure_host</span></a>. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureKeyProviderFactory</span>
<span class="w">  </span><span class="nt">azure_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-azure1</span>
</pre></div>
</div>
</div></div>
</li>
<li><p>Save the file.</p></li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-10-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-10-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-10-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-10-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-10-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-10-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ol>
</section>
<section id="encrypt-a-single-table">
<span id="ear-create-table"></span><h2>Encrypt a Single Table<a class="headerlink" href="#encrypt-a-single-table" title="Link to this heading">¶</a></h2>
<p>ScyllaDB lets you configure encryption for individual tables using the
<code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> in the table schema. This allows you to enable or
disable encryption per table, or override default <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code>
settings from <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>, such as the key or key length.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The settings in <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> are treated as a
complete replacement of the defaults. They are never merged with or inherited
from <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code>.  Any option you omit will fall back to its own
built-in default, <strong>not</strong> to the value defined in <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> in
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>.</p>
</div>
<section id="allow-per-table-encryption">
<h3>Allow Per-Table Encryption<a class="headerlink" href="#allow-per-table-encryption" title="Link to this heading">¶</a></h3>
<p>ScyllaDB offers the <code class="docutils literal notranslate"><span class="pre">allow_per_table_encryption</span></code> configuration option to
enable or disable per-table encryption on a particular node. The default value
is <code class="docutils literal notranslate"><span class="pre">true</span></code>, i.e., per-table encryption is enabled.</p>
<p>With per-table encryption disabled in your cluster:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> and <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> statements that include
<code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> will be rejected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> from existing tables will be ignored, falling
back to the <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> settings from <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>, or leaving
the table unencrypted if no default encryption settings are provided in the
configuration.</p></li>
</ul>
<p>If you want to disable per-table encryption in your cluster, run the following
commands on each node:</p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> and set the option
to <code class="docutils literal notranslate"><span class="pre">false</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">allow_per_table_encryption</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-11-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-11-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-11-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-11-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-11-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-11-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ol>
</section>
<section id="encrypt-a-new-table">
<h3>Encrypt a New Table<a class="headerlink" href="#encrypt-a-new-table" title="Link to this heading">¶</a></h3>
<p>This procedure demonstrates how to encrypt a new table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to encrypt an existing table, follow the <a class="reference internal" href="#update-encryption-properties-of-existing-tables">Update Encryption Properties of Existing Tables</a> procedure.</p>
</div>
<p><strong>Before you Begin</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-12-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-12-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-12-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-12-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-12-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-12-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-12-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-12-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-12-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><ul>
<li><p>If you want to create your own key, follow the procedure in
<a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a>.</p></li>
<li><p>If you want to let Scylla create the key for you, run the following
commands on every node in the cluster to configure a directory for your
keys.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the default location <code class="docutils literal notranslate"><span class="pre">/etc/scylla/data_encryption_keys</span></code>
results in a known permission issue (scylladb/scylla-tools-java#94),
so it is recommended to use another location as described in the
example.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /etc/scylla/encryption_keys
sudo chown -R scylla:scylla /etc/scylla/encryption_keys
sudo chmod -R 700 /etc/scylla/encryption_keys
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-12-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><ul>
<li><p>Ensure you have a system key. The system key can be either a local key,
or a KMIP key. If you don’t have a system key, create one by following
the procedure in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a>.</p></li>
<li><p>Ensure the system key is properly configured in each node’s configuration
file (<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code>):</p>
<ul class="simple">
<li><p>If the system key is a local key, set the top-level option
<code class="docutils literal notranslate"><span class="pre">system_key_directory:</span> <span class="pre">&lt;path&gt;</span></code> in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> to the directory
containing the system key.</p></li>
<li><p>If the system key is a KMIP key, <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">set up a KMIP Host</span></a>.</p></li>
</ul>
</li>
<li><p>Ensure you have a local secret key:</p>
<ul>
<li><p>If you want to create your own local secret key, follow the procedure
in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a>. Note
that you cannot reuse the same local key as both system key and secret
key; they must be different keys.</p></li>
<li><p>If you want ScyllaDB to generate the local secret key for you, run the
following commands on every node in the cluster to configure a
directory for your keys:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the default location <code class="docutils literal notranslate"><span class="pre">/etc/scylla/data_encryption_keys</span></code>
results in a known permission issue (scylladb/scylla-tools-java#94),
so it is recommended to use another location as described in the
example.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /etc/scylla/encryption_keys
sudo chown -R scylla:scylla /etc/scylla/encryption_keys
sudo chmod -R 700 /etc/scylla/encryption_keys
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div><div aria-labelledby="tab-12-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">set up a KMIP Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-12-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">set up a KMS Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-12-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">set up a GCP Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-12-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">set up an Azure Host</span></a>.</p></li>
</ul>
</div></div>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Create the keyspace if it doesn’t exist.</p></li>
<li><p>Create the table using the following <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> CQL statement, adding
any <a class="reference internal" href="../../cql/ddl.html#create-table-statement"><span class="std std-ref">additional options</span></a>.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-13-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-13-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-13-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-13-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-13-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-13-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-13-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-13-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-13-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;alg&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;LocalFileSystemKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;path&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> -  One of the  <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithm</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the <a class="reference internal" href="#ear-key-providers"><span class="std std-ref">key provider</span></a>. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> - The location of the key created by you in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a> or that will be created
by Scylla. If not provided, the default value is <code class="docutils literal notranslate"><span class="pre">/etc/scylla/data_encryption_keys</span></code>.</p></li>
</ul>
<p><strong>Example:</strong></p>
<p>Using the example directory configured in the “Before you Begin”
section, this command will instruct ScyllaDB to encrypt the table with
a key stored in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/encryption_keys/data_encryption_keys</span></code>.</p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="n">pk</span> <span class="nb">text</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">c0</span> <span class="nb">int</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;AES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;LocalFileSystemKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/data_encryption_keys&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;alg&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;ReplicatedKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;system_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;&lt;file_name&gt;|kmip://&lt;kmip_host&gt;/&lt;key_id&gt;&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;secret_key&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Where:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> -  One of the  <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithm</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the <a class="reference internal" href="#ear-key-providers"><span class="std std-ref">key provider</span></a>. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system_key_file</span></code> - The system key filename or KMIP URI.</p>
<ul class="simple">
<li><p>For a local system key, specify the filename of your key; ScyllaDB will attempt to load it from the directory set by <code class="docutils literal notranslate"><span class="pre">system_key_directory</span></code> in
<code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> (default directory: <code class="docutils literal notranslate"><span class="pre">/etc/scylla/conf/resources/system_keys/</span></code>).</p></li>
<li><p>For a KMIP system key, use the URI format <code class="docutils literal notranslate"><span class="pre">kmip://&lt;kmip_host&gt;/&lt;key_id&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;kmip_host&gt;</span></code> is a KMIP host configured in <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> of
each node, and <code class="docutils literal notranslate"><span class="pre">&lt;key_id&gt;</span></code> is the key’s unique identifier in the KMIP server.</p></li>
</ul>
<p>If you omit this option, it defaults to <code class="docutils literal notranslate"><span class="pre">system_key</span></code> (i.e., the local system key: <code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system_key</span></code>).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> - The location of the local secret key. This can be either an absolute pathname, or a pathname relative to ScyllaDB’s working
directory. Default value is <code class="docutils literal notranslate"><span class="pre">/etc/scylla/data_encryption_keys</span></code>.</p></li>
</ul>
<p><strong>Example with local system key:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span>  <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;ReplicatedKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;system_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;system_key&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/data_encryption_keys&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p><strong>Example with KMIP system key:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span>  <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;ReplicatedKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;system_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;kmip://my-kmip1/123e4567-e89b-12d3-a456-426655440000&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/data_encryption_keys&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;alg&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;KmipKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;kmip_host&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;kmip_host&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;template_name&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;key_namespace&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;key_namespace&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> -  One of the  <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithm</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the <a class="reference internal" href="#ear-key-providers"><span class="std std-ref">key provider</span></a>. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kmip_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">kmip_host</span></a> group. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">template_name</span></code> - The name of a KMIP template to use when creating new keys. Optional.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_namespace</span></code> - A KMIP namespace. Using namespaces allows you to granularly manage keys on a per table or keyspace basis. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span>  <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;KmipKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;kmip_host&#39;</span><span class="p">:</span> <span class="s1">&#39;my-kmip1&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;alg&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;KmsKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;kms_host&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;kms_host&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;master_key&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;aws_kms_key&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;aws_assume_role_arn&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;aws_assume_role_arn&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> -  One of the  <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithm</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the <a class="reference internal" href="#ear-key-providers"><span class="std std-ref">key provider</span></a>. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kms_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">kms_host</span></a> group. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The ID or alias of an AWS KMS key. It allows you to specify a different key than the one configured in the <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">kms_host</span></a>. Optional.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_assume_role_arn</span></code> - The ARN of an AWS role to assume before calling KMS. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span>  <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;KmsKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;kms_host&#39;</span><span class="p">:</span> <span class="s1">&#39;my-kms1&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;alg&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;GcpKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gcp_host&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;gcp_host&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;master_key&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;gcp_kms_key&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gcp_impersonate_service_account&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;gcp_impersonate_service_account&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> -  One of the  <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithm</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the <a class="reference internal" href="#ear-key-providers"><span class="std std-ref">key provider</span></a>. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">gcp_host</span></a> group. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The &lt;keyring&gt;/&lt;keyname&gt; of a GCP KMS key. It allows you to specify a different key than the one configured in the <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">gcp_host</span></a>. Optional.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_impersonate_service_account</span></code> - The service account to impersonate when calling GCP APIs. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span>  <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;GcpKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gcp_host&#39;</span><span class="p">:</span> <span class="s1">&#39;my-gcp1&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;alg&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;AzureKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;azure_host&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;azure_host&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;master_key&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;azure_vault_key&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> -  One of the  <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithm</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the <a class="reference internal" href="#ear-key-providers"><span class="std std-ref">key provider</span></a>. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">azure_host</span></a> group. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master_key</span></code> - The &lt;vaultname&gt;/&lt;keyname&gt; of an Azure Key Vault key. It allows you to specify a different key than the one configured in the
<a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">azure_host</span></a>. Optional.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="mf">...</span><span class="o">&lt;</span><span class="n">columns</span><span class="o">&gt;</span><span class="mf">...</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span>  <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;AzureKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;azure_host&#39;</span><span class="p">:</span> <span class="s1">&#39;my-azure1&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</div></div>
</li>
<li><p>From this point forward, every new SSTable created for the <code class="docutils literal notranslate"><span class="pre">mytable</span></code> table
will be encrypted using the provided key. The table will remain encrypted
with this key until you change the key, change the key properties, or disable
encryption. To perform any of these actions, follow the <a class="reference internal" href="#update-encryption-properties-of-existing-tables">Update Encryption
Properties of Existing Tables</a> procedure. Always keep your key in a safe
location known to you. Do not lose it. If the key is lost, refer to <a class="reference internal" href="#when-a-key-is-lost">When a
Key is Lost</a>.</p></li>
</ol>
</section>
<section id="update-encryption-properties-of-existing-tables">
<span id="ear-alter-table"></span><h3>Update Encryption Properties of Existing Tables<a class="headerlink" href="#update-encryption-properties-of-existing-tables" title="Link to this heading">¶</a></h3>
<p>ScyllaDB allows you to change the encryption properties of any existing table.
This includes enabling encryption on an unencrypted table, disabling encryption
on an encrypted table, or changing the cipher algorithm, key strength, or key
location for an encrypted table.</p>
<section id="encrypt-an-existing-table">
<h4>Encrypt an Existing Table<a class="headerlink" href="#encrypt-an-existing-table" title="Link to this heading">¶</a></h4>
<p>To apply encryption to an existing table, repeat the steps from <a class="reference internal" href="#encrypt-a-single-table">Encrypt a Single
Table</a>, but replace the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> CQL statement with the <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="n">pk</span> <span class="nb">text</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">c0</span> <span class="nb">int</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span> <span class="s1">&#39;AES/ECB/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">192</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;LocalFileSystemKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/data_encryption_keys&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Existing SSTables will remain unencrypted until the next compaction
re-creates them using the new encryption configuration. To encrypt them
immediately instead, run <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> <strong>on each node</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables &lt;keyspace&gt; &lt;table&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables myks mytable
</pre></div>
</div>
</div>
</section>
<section id="change-the-algorithm-descriptor-or-key-of-an-existing-table">
<h4>Change the Algorithm Descriptor or Key of an Existing Table<a class="headerlink" href="#change-the-algorithm-descriptor-or-key-of-an-existing-table" title="Link to this heading">¶</a></h4>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Find the <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> of the table you want to change:</p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">DESCRIBE</span> <span class="o">&lt;</span><span class="k">keyspace</span><span class="o">&gt;</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">table_name</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">DESCRIBE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Example output:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span>
  <span class="n">pk</span> <span class="nb">text</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">c0</span> <span class="nb">int</span>
<span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span> <span class="s1">&#39;AES/ECB/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;LocalFileSystemKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/data_encryption_keys&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Run an <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> statement using the same <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code>
found in the previous step, except for the properties you wish to change.</p>
<p><strong>Example for changing the Cipher Algorithm and Key Strength:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="n">pk</span> <span class="nb">text</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">c0</span> <span class="nb">int</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span> <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">192</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;LocalFileSystemKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/data_encryption_keys&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p><strong>Example for changing the KMS Master Key:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="p">(</span><span class="n">pk</span> <span class="nb">text</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">c0</span> <span class="nb">int</span><span class="p">)</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span> <span class="p">:</span> <span class="s1">&#39;AES/ECB/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span> <span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;KmsKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;master_key&#39;</span><span class="p">:</span> <span class="s1">&#39;myorg/MyNewKey&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you change the key, the SSTables that existed before this change will
remain encrypted with the old key until the next compaction automatically
re-encrypts them with the new key. In the meantime, ScyllaDB will still be
able to read them as long as the old key remains available. If the old key is
gone, the old data will be unreadable. If you don’t want to wait for
compaction, run <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> <strong>on each node</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables &lt;keyspace&gt; &lt;table&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables myks mytable
</pre></div>
</div>
</div>
</section>
<section id="disable-encryption-on-existing-table">
<h4>Disable Encryption on Existing Table<a class="headerlink" href="#disable-encryption-on-existing-table" title="Link to this heading">¶</a></h4>
<p>To remove the <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> from a table, set the
<code class="docutils literal notranslate"><span class="pre">key_provider</span></code> to <code class="docutils literal notranslate"><span class="pre">none</span></code>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="k">WITH</span>
   <span class="n">scylla_encryption_options</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;key_provider&#39;</span> <span class="p">:</span> <span class="s1">&#39;none&#39;</span> <span class="p">};</span>
</pre></div>
</div>
<p>The effect of this schema change is that subsequently written SSTables on each
node will conform to the <code class="docutils literal notranslate"><span class="pre">user_info_encryption</span></code> defaults of this node. If no
such defaults exist on a node, the newly written SSTables on that node will be
unencrypted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you disable encryption, the SSTables that existed before this change will
remain encrypted until the next compaction. In the meantime, ScyllaDB will
still be able to read them as long as the key remains available. If the key
is gone, the old data will be unreadable. If you don’t want to wait for
compaction, run <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> <strong>on each node</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables &lt;keyspace&gt; &lt;table&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables myks mytable
</pre></div>
</div>
</div>
</section>
</section>
</section>
<section id="encrypt-system-resources">
<h2>Encrypt System Resources<a class="headerlink" href="#encrypt-system-resources" title="Link to this heading">¶</a></h2>
<p>System encryption is applied to two types of system resources:</p>
<ol class="arabic simple">
<li><p><strong>System tables</strong>: These include the batchlog table (<code class="docutils literal notranslate"><span class="pre">system.batchlog</span></code>),
the Paxos table (<code class="docutils literal notranslate"><span class="pre">system.paxos</span></code>), and the dictionary table (<code class="docutils literal notranslate"><span class="pre">system.dicts</span></code>).</p></li>
<li><p><strong>Transient on-disk data</strong>: Semi-transient data, such as commit logs and
hinted handoff data, which are temporarily stored on disk until fully
persisted to SSTables.</p></li>
</ol>
<p>Once this encryption is enabled, it is used for all system data.</p>
<p><strong>Before you Begin</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-14-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-14-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-14-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-14-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-14-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-14-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-14-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-14-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-14-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><ul>
<li><p>If you want to create your own system key, follow the procedure in
<a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a>.</p></li>
<li><p>If you want to let Scylla create the system key for you, run the
following commands on every node in the cluster to configure a directory
for your keys.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the default location <code class="docutils literal notranslate"><span class="pre">/etc/scylla/data_encryption_keys</span></code>
results in a known permission issue (scylladb/scylla-tools-java#94),
so it is recommended to use another location as described in the
example.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /etc/scylla/encryption_keys
sudo chown -R scylla:scylla /etc/scylla/encryption_keys
sudo chmod -R 700 /etc/scylla/encryption_keys
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-14-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The Replicated Key Provider cannot be used for system encryption. You can
only use it to <a class="reference internal" href="#ear-create-table"><span class="std std-ref">Encrypt a Single Table</span></a>.</p>
</div><div aria-labelledby="tab-14-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">set up a KMIP Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-14-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">set up a KMS Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-14-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">set up a GCP Host</span></a>.</p></li>
</ul>
</div><div aria-labelledby="tab-14-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Make sure to <a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">set up an Azure Host</span></a>.</p></li>
</ul>
</div></div>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> file located in <code class="docutils literal notranslate"><span class="pre">/etc/scylla/</span></code> and configure the
<code class="docutils literal notranslate"><span class="pre">system_info_encryption</span></code> section based on your key provider:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-15-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-15-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-15-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-15-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-15-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-15-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-15-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-15-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-15-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-15-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-15-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-15-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-15-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-15-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_key_directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path to system key directory&gt;</span>

<span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">secret_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;system key file&gt;</span>
<span class="w">  </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;system key name&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables system encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> - Full path to the system key file created by you in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a> or that will be
created by Scylla. If set, Scylla will load the key directly from this location. Defaults to <code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system/&lt;key_name&gt;</span></code> when not
provided.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_name</span></code> (optional) - Base name of the system key file. Scylla constructs the path as <code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system/&lt;key_name&gt;</span></code>. Only used if
<code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> is <strong>not</strong> specified. Defaults to <code class="docutils literal notranslate"><span class="pre">system_table_keytab</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system_key_directory</span></code> (optional) - Directory that contains system key files. Used only when <code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code> is <strong>not</strong> set to locate
<code class="docutils literal notranslate"><span class="pre">&lt;system_key_directory&gt;/system/&lt;key_name&gt;</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">/etc/scylla/conf/resources/system_keys/</span></code>.</p></li>
</ul>
<p><strong>Example with secret key file:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">secret_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/scylla/encryption_keys/system_keys/system_key</span>
</pre></div>
</div>
<p><strong>Example with key name:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_key_directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/scylla/encryption_keys/system_keys</span>

<span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_key</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-15-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-15-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The Replicated Key Provider cannot be used for system encryption. You
can only use it to <a class="reference internal" href="#ear-create-table"><span class="std std-ref">Encrypt a Single Table</span></a>.</p>
</div><div aria-labelledby="tab-15-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-15-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmipKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kmip_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;kmip_host&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables system encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kmip_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-kmip"><span class="std std-ref">kmip_host</span></a> group. Required.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmipKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kmip_host</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">my-kmip1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-15-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-15-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmsKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kms_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;kms_host&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables system encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kms_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-kms"><span class="std std-ref">kms_host</span></a> group. Required.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KmsKeyProviderFactory</span>
<span class="w">  </span><span class="nt">kms_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-kms1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-15-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-15-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GcpKeyProviderFactory</span>
<span class="w">  </span><span class="nt">gcp_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;gcp_host&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables system encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gcp_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-gcp"><span class="std std-ref">gcp_host</span></a> group. Required.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GcpKeyProviderFactory</span>
<span class="w">  </span><span class="nt">gcp_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-gcp1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-15-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-15-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hashing algorithm to create the key&gt;</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;length of the key&gt;</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureKeyProviderFactory</span>
<span class="w">  </span><span class="nt">azure_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;azure_host&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> - Enables or disables system encryption. Required. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cipher_algorithm</span></code> - One of the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a>. If not provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret_key_strength</span></code> - The length of the key in bits (determined by the <a class="reference internal" href="#ear-cipher-algorithms"><span class="std std-ref">cipher algorithms</span></a> you choose). If not
provided, the default will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_provider</span></code> - The name of the key provider. Required.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azure_host</span></code> - The name of your <a class="reference internal" href="#encryption-at-rest-set-azure"><span class="std std-ref">azure_host</span></a> group. Required.</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AzureKeyProviderFactory</span>
<span class="w">  </span><span class="nt">azure_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-azure1</span>
</pre></div>
</div>
</div></div>
</li>
<li><p>Save the file.</p></li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-16-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-16-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-16-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-16-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-16-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-16-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-16-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-16-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ol>
</section>
<section id="rotate-encryption-keys">
<h2>Rotate Encryption Keys<a class="headerlink" href="#rotate-encryption-keys" title="Link to this heading">¶</a></h2>
<p>Key rotation is the process of replacing an existing encryption key with a new
one. This might be necessary when a key is compromised, or, more commonly, to
comply with regulatory requirements. The key rotation procedure in ScyllaDB
varies depending on the key provider you are using.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-17-TG9jYWwgS2V5IFByb3ZpZGVy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-17-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tab" tabindex="0">Local Key Provider</button><button aria-controls="panel-17-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-17-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">Replicated Key Provider</button><button aria-controls="panel-17-S01JUCBLZXkgUHJvdmlkZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-17-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tab" tabindex="-1">KMIP Key Provider</button><button aria-controls="panel-17-S01TIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-17-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">KMS Key Provider</button><button aria-controls="panel-17-R0NQIEtleSBQcm92aWRlcg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-17-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tab" tabindex="-1">GCP Key Provider</button><button aria-controls="panel-17-QXp1cmUgS2V5IFByb3ZpZGVy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-17-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tab" tabindex="-1">Azure Key Provider</button></div><div aria-labelledby="tab-17-TG9jYWwgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" id="panel-17-TG9jYWwgS2V5IFByb3ZpZGVy" name="TG9jYWwgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Generate a new encryption key.</p>
<ul class="simple">
<li><p>If you want to provide your own key, follow the procedure in
<a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption Keys</span></a>.</p></li>
<li><p>If you want to let ScyllaDB generate a key for you, select a name and
location for the key file and make sure that the <code class="docutils literal notranslate"><span class="pre">scylla</span></code> user has
Read, Write, and Execute permissions over the parent directory.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not overwrite the existing key file. Select a different
name or location for the new key file. For example, use the current
date as a suffix: <code class="docutils literal notranslate"><span class="pre">/etc/scylla/encryption_keys/secret_key_20250613</span></code>.</p>
</div>
</li>
<li><p>If the key is used in the default encryption configuration:</p>
<ol class="arabic">
<li><p>Update your <code class="docutils literal notranslate"><span class="pre">scylla.yaml</span></code> configuration to point to the new key file.</p>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">user_info_encryption</span><span class="p">:</span>
<span class="c1"># or</span>
<span class="nt">system_info_encryption</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">cipher_algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AES/CBC/PKCS5Padding</span>
<span class="w">  </span><span class="nt">secret_key_strength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">  </span><span class="nt">key_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalFileSystemKeyProviderFactory</span>
<span class="w">  </span><span class="nt">secret_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/scylla/encryption_keys/secret_key_20250613</span>
</pre></div>
</div>
</li>
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service to load the updated configuration.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-18-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-18-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-18-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-18-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-18-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-18-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-18-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-18-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
<li><p>Repeat on all nodes.</p></li>
</ol>
</li>
<li><p>In the schema of any desired table, point the <code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code>
inside <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> to the new key file, using the
<code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> CQL statement. Use the <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span></code> CQL statement first,
for retrieving the current <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code>. Repeat all
entries from <code class="docutils literal notranslate"><span class="pre">scylla_encryption_options</span></code> identically, apart from
<code class="docutils literal notranslate"><span class="pre">secret_key_file</span></code>, in the <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> statement.</p>
<p><strong>Example:</strong></p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">myks</span><span class="mf">.</span><span class="n">mytable</span> <span class="k">WITH</span>
  <span class="n">scylla_encryption_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cipher_algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;AES/CBC/PKCS5Padding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_strength&#39;</span><span class="p">:</span> <span class="mf">128</span><span class="p">,</span>
    <span class="s1">&#39;key_provider&#39;</span><span class="p">:</span> <span class="s1">&#39;LocalFileSystemKeyProviderFactory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret_key_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/scylla/encryption_keys/secret_key_20250613&#39;</span>
  <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Optionally, force the upgrade of all SSTables by running <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> on each node.
This will re-encrypt old SSTables with the new key. If you do not run
this command, old SSTables will remain encrypted with the old key until
they are naturally compacted.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables
</pre></div>
</div>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not delete the old key if there are still system artifacts
(commitlog segments, hints) and/or SSTables that are encrypted with it.
In any case, it is advised to always maintain a backup of your old keys.
Refer to <a class="reference internal" href="#when-a-key-is-lost">When a Key is Lost</a> for more information.</p>
</div>
</div><div aria-labelledby="tab-17-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-17-UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" name="UmVwbGljYXRlZCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p>The Replicated Key Provider does not support key rotation. If you need to
rotate keys, you must migrate to a different key provider.</p>
</div><div aria-labelledby="tab-17-S01JUCBLZXkgUHJvdmlkZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-17-S01JUCBLZXkgUHJvdmlkZXI=" name="S01JUCBLZXkgUHJvdmlkZXI=" role="tabpanel" tabindex="0"><p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Create a new key by following the procedure in <a class="reference internal" href="#ear-create-encryption-key"><span class="std std-ref">Create Encryption
Keys</span></a>.</p></li>
<li><p>Revoke the old key using the <code class="docutils literal notranslate"><span class="pre">Superseded</span></code> revocation reason (or any
reason other than <code class="docutils literal notranslate"><span class="pre">Compromised</span></code>). This will transition the key to a
<code class="docutils literal notranslate"><span class="pre">Deactivated</span></code> state, preventing ScyllaDB from selecting it for future
encryption operations when refreshing its key cache. However, ScyllaDB
will still be able to use this key to decrypt old data.</p></li>
<li><p>Clear the old key from the key cache:</p>
<ul>
<li><p>You can choose to wait for the KMIP host’s <code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code>
interval (default is 30 seconds), after which ScyllaDB will
automatically clear the key cache, or</p></li>
<li><p>You can clear the key cache of each node manually by draining the node
with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>
and then restarting the scylla-server service:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-19-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-19-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-19-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-19-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-19-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-19-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-19-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-19-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
</ul>
</li>
<li><p>Optionally, force the upgrade of all SSTables by running <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> on each node.
This will re-encrypt old SSTables with the new key. If you do not run
this command, old SSTables will remain encrypted with the old key until
they are naturally compacted.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables
</pre></div>
</div>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not delete the old key if there are still system artifacts
(commitlog segments, hints) and/or SSTables that are encrypted with it.
In any case, it is advised to always maintain a backup of your old keys.
Refer to <a class="reference internal" href="#when-a-key-is-lost">When a Key is Lost</a> for more information.</p>
</div>
</div><div aria-labelledby="tab-17-S01TIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-17-S01TIEtleSBQcm92aWRlcg==" name="S01TIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><p>For the KMS Key Provider, key rotation must be configured and performed in
AWS KMS. It is recommended to enable automatic key rotation with a
rotation period of one year. For more information, see the <a class="reference external" href="https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html">AWS KMS
documentation</a>.</p>
<p>No additional configuration is required for ScyllaDB. ScyllaDB will
automatically use the latest version of the key when encrypting new data,
and the AWS KMS will detect and use the appropriate key version when
decrypting old data.</p>
<p>When a key is rotated, previously written out system artifacts and
SSTables are not affected, meaning that they remain encrypted with the old
key version. Additionally, for a few minutes after the rotation, ScyllaDB
may be generating new system artifacts and SSTables with the old key
version, due to cached data encryption keys created before the rotation
(keys are cached for 10 minutes by default, depending on the
<code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> option). Eventually, the cached data encryption keys
will be evicted and the old SSTables will be re-encrypted with the new key
version when they are naturally compacted. If you prefer not to wait for
this process to complete on its own, you can run the following steps on
each node:</p>
<ol class="arabic">
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service to discard any cached data encryption
keys wrapped with the old key version:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-20-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-20-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-20-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-20-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-20-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-20-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-20-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-20-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
<li><p>Force the upgrade of all SSTables with <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> to re-encrypt
them with the new key version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables
</pre></div>
</div>
</li>
</ol>
</div><div aria-labelledby="tab-17-R0NQIEtleSBQcm92aWRlcg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-17-R0NQIEtleSBQcm92aWRlcg==" name="R0NQIEtleSBQcm92aWRlcg==" role="tabpanel" tabindex="0"><p>For the GCP Key Provider, key rotation must be configured and performed in
Google Cloud KMS. It is recommended to enable automatic key rotation with
a rotation period of one year. For more information, see the <a class="reference external" href="https://cloud.google.com/kms/docs/key-rotation">Google Cloud
KMS documentation</a>.</p>
<p>No additional configuration is required for ScyllaDB. ScyllaDB will
automatically use the primary version of the key when encrypting new data,
and the Google Cloud KMS will detect and use the appropriate key version
when decrypting old data.</p>
<p>When a key is rotated, previously written out system artifacts and
SSTables are not affected, meaning that they remain encrypted with the old
key version. Additionally, for a few minutes after the rotation, ScyllaDB
may be generating new system artifacts and SSTables with the old key
version, due to cached data encryption keys created before the rotation
(keys are cached for 10 minutes by default, depending on the
<code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> option). Eventually, the cached data encryption keys
will be evicted and the old SSTables will be re-encrypted with the new key
version when they are naturally compacted. If you prefer not to wait for
this process to complete on its own, you can run the following steps on
each node:</p>
<ol class="arabic">
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service to discard any cached data encryption
keys wrapped with the old key version:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-21-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-21-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-21-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-21-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-21-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-21-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-21-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-21-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
<li><p>Force the upgrade of all SSTables with <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> to re-encrypt
them with the new key version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables
</pre></div>
</div>
</li>
</ol>
</div><div aria-labelledby="tab-17-QXp1cmUgS2V5IFByb3ZpZGVy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-17-QXp1cmUgS2V5IFByb3ZpZGVy" name="QXp1cmUgS2V5IFByb3ZpZGVy" role="tabpanel" tabindex="0"><p>For the Azure Key Provider, key rotation must be configured and performed
in Azure Key Vault. It is recommended to enable automatic key rotation
with a rotation period of one year. For more information, see the <a class="reference external" href="https://learn.microsoft.com/en-us/azure/key-vault/keys/how-to-configure-key-rotation">Azure
Key Vault documentation</a>.</p>
<p>No additional configuration is required for ScyllaDB. ScyllaDB will
automatically use the latest version of the key when encrypting new data,
and the appropriate key version when decrypting old data. ScyllaDB stores
the key version along with the encrypted data encryption key in the
SSTable and commitlog metadata, which allows it to track the exact version
used for encryption.</p>
<p>When a key is rotated, previously written out system artifacts and
SSTables are not affected, meaning that they remain encrypted with the old
key version. Additionally, for a few minutes after the rotation, ScyllaDB
may be generating new system artifacts and SSTables with the old key
version, due to cached data encryption keys created before the rotation
(keys are cached for 10 minutes by default, depending on the
<code class="docutils literal notranslate"><span class="pre">key_cache_expiry</span></code> option). Eventually, the cached data encryption keys
will be evicted and the old SSTables will be re-encrypted with the new key
version when they are naturally compacted. If you prefer not to wait for
this process to complete on its own, you can run the following steps on
each node:</p>
<ol class="arabic">
<li><p>Drain the node with <a class="reference internal" href="../nodetool-commands/drain.html"><span class="doc">nodetool drain</span></a>.</p></li>
<li><p>Restart the scylla-server service to discard any cached data encryption
keys wrapped with the old key version:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-22-U3VwcG9ydGVkIE9T" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-22-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tab" tabindex="0">Supported OS</button><button aria-controls="panel-22-RG9ja2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-22-RG9ja2Vy" name="RG9ja2Vy" role="tab" tabindex="-1">Docker</button></div><div aria-labelledby="tab-22-U3VwcG9ydGVkIE9T" class="sphinx-tabs-panel group-tab" id="panel-22-U3VwcG9ydGVkIE9T" name="U3VwcG9ydGVkIE9T" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>scylla-server
</pre></div>
</div>
</div><div aria-labelledby="tab-22-RG9ja2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-22-RG9ja2Vy" name="RG9ja2Vy" role="tabpanel" tabindex="0"><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>some-scylla<span class="w"> </span>supervisorctl<span class="w"> </span>restart<span class="w"> </span>scylla
</pre></div>
</div>
<p>(without restarting <em>some-scylla</em> container)</p>
</div></div>
</li>
<li><p>Force the upgrade of all SSTables with <a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a> to re-encrypt
them with the new key version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nodetool upgradesstables --include-all-sstables
</pre></div>
</div>
</li>
</ol>
</div></div>
</section>
<section id="when-a-key-is-lost">
<h2>When a Key is Lost<a class="headerlink" href="#when-a-key-is-lost" title="Link to this heading">¶</a></h2>
<p>It is crucial to back up all of your encryption keys in a secure way. Keep a
copy of all keys in a secure location. In the event that you do lose a key, your
data encrypted with that key will be unreadable.</p>
</section>
<section id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../nodetool-commands/upgradesstables.html"><span class="doc">nodetool upgradesstables</span></a></p></li>
<li><p><a class="reference internal" href="../../cql/ddl.html#create-table-statement"><span class="std std-ref">CREATE TABLE parameters</span></a></p></li>
</ul>
</section>
</section>

                </div>
                
                    <div class="post-content">
                        
    <div class="feedback-container">
        <p class="feedback-container__title">Was this page helpful?</p>
        <span data-tooltip tabindex="1" title="Yes" data-position="top">
            <button class="feedback-container__button" id="feedback-positive">
                <i class="feedback-container__icon icon-docs-thumbs-up"></i>
            </button>
        </span>
        <span data-tooltip tabindex="1" title="No" data-position="top">
            <button class="feedback-container__button" id="feedback-negative">
                <i class="feedback-container__icon icon-docs-thumbs-down"></i>
            </button>
        </span>
        <div class="feedback-container__message" id="feedback-message"></div>
    </div>

    <script>
        function resetFeedbackButtonActive() {
            const feedbackButtons = document.getElementsByClassName('feedback-container__button');
            for (let i = 0; i < feedbackButtons.length; i++) {
                feedbackButtons[i].classList.remove('active');
            }
        }

        function showMessage(liked) {
            const feedbackMessage = document.getElementById('feedback-message');
            const themeGithubRepository = true;
            let message = 'Great! Thanks for your feedback.';
            if (themeGithubRepository && !liked) {
                message = "Thanks for your feedback! Please don't hesitate to <a href='https://github.com/scylladb/scylladb/issues/new?title=docs:%20Issue on page Encryption at Rest&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://docs.scylladb.com/manual/branch-2025.4/operating-scylla/security/encryption-at-rest%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation'>create an issue</a> if you have any suggestions on how we can improve.";
            }
            feedbackMessage.innerHTML = message;
        }

        function sendGaEvent(liked) {
            const event_label = liked ? "positive" : "negative";
            const event = "feedback_" + event_label;
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': event,
            });
        }

        const positiveFeebackButton = document.getElementById('feedback-positive');
        const negativeFeedbackButton = document.getElementById('feedback-negative');

        positiveFeebackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(true);
            showMessage(true);
            positiveFeebackButton.classList.add('active');
        });

        negativeFeedbackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(false);
            showMessage(false);
            negativeFeedbackButton.classList.add('active');
        });
    </script>

                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="saslauthd.html">
                <button class="navigation__button">
                    <i class="icon-chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Configure SaslauthdAuthenticator
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="ldap-authentication.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />LDAP Authentication
                </div>
                <button class="navigation__button">
                    <i class="icon-chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                

                
                    </div>
                    <div class="sidebar-right large-order-3">
                        <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a class="button button-sm" href="https://github.com/scylladb/scylladb/issues/new?title=docs:%20Issue on page Encryption at Rest&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://docs.scylladb.com/manual/branch-2025.4/operating-scylla/security/encryption-at-rest%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
               target="_blank">
                <i class="icon-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a class="button button-sm" href="https://github.com/scylladb/scylladb/edit/master/docs/operating-scylla/security/encryption-at-rest.rst"
                   target="_blank">
                    <i class="icon-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Encryption at Rest</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#about-encryption-at-rest">About Encryption at Rest</a><ul>
<li><a class="reference internal" href="#when-is-data-encrypted">When is Data Encrypted?</a></li>
<li><a class="reference internal" href="#when-is-data-decrypted">When is Data Decrypted?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-classes-for-encryption">Data Classes for Encryption</a></li>
<li><a class="reference internal" href="#cipher-algorithm-descriptors">Cipher Algorithm Descriptors</a></li>
<li><a class="reference internal" href="#key-providers">Key Providers</a><ul>
<li><a class="reference internal" href="#local-key-provider">Local Key Provider</a></li>
<li><a class="reference internal" href="#replicated-key-provider">Replicated Key Provider</a></li>
<li><a class="reference internal" href="#kmip-key-provider">KMIP Key Provider</a></li>
<li><a class="reference internal" href="#kms-key-provider">KMS Key Provider</a></li>
<li><a class="reference internal" href="#gcp-key-provider">GCP Key Provider</a></li>
<li><a class="reference internal" href="#azure-key-provider">Azure Key Provider</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-encryption-keys">Create Encryption Keys</a></li>
<li><a class="reference internal" href="#set-the-kmip-host">Set the KMIP Host</a></li>
<li><a class="reference internal" href="#set-the-kms-host">Set the KMS Host</a></li>
<li><a class="reference internal" href="#set-the-gcp-host">Set the GCP Host</a></li>
<li><a class="reference internal" href="#set-the-azure-host">Set the Azure Host</a></li>
<li><a class="reference internal" href="#encrypt-tables">Encrypt Tables</a></li>
<li><a class="reference internal" href="#encrypt-a-single-table">Encrypt a Single Table</a><ul>
<li><a class="reference internal" href="#allow-per-table-encryption">Allow Per-Table Encryption</a></li>
<li><a class="reference internal" href="#encrypt-a-new-table">Encrypt a New Table</a></li>
<li><a class="reference internal" href="#update-encryption-properties-of-existing-tables">Update Encryption Properties of Existing Tables</a><ul>
<li><a class="reference internal" href="#encrypt-an-existing-table">Encrypt an Existing Table</a></li>
<li><a class="reference internal" href="#change-the-algorithm-descriptor-or-key-of-an-existing-table">Change the Algorithm Descriptor or Key of an Existing Table</a></li>
<li><a class="reference internal" href="#disable-encryption-on-existing-table">Disable Encryption on Existing Table</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#encrypt-system-resources">Encrypt System Resources</a></li>
<li><a class="reference internal" href="#rotate-encryption-keys">Rotate Encryption Keys</a></li>
<li><a class="reference internal" href="#when-a-key-is-lost">When a Key is Lost</a></li>
<li><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                    </div>
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="icon-docs-menu-collapse"></i>
    </button>
    <div class="side-nav-content custom-scroll-bar">
        <div class="side-nav__title">
            <a href="../../index.html">ScyllaDB Manual</a>
        </div>
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                2025.4
            
            <i class="chevron icon-docs-chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="../../../master/operating-scylla/security/encryption-at-rest.html">master</a>
                    </li>
                
            
                
                    <li>
                        <a href="encryption-at-rest.html">2025.4</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../branch-2025.3/operating-scylla/security/encryption-at-rest.html">2025.3</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../branch-2025.2/operating-scylla/security/encryption-at-rest.html">2025.2</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../branch-2025.1/operating-scylla/security/encryption-at-rest.html">2025.1</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../getting-started/install-scylla/index.html">Install ScyllaDB</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/install-scylla/launch-on-aws.html">Launch ScyllaDB on AWS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/install-scylla/launch-on-gcp.html">Launch ScyllaDB on GCP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/install-scylla/launch-on-azure.html">Launch ScyllaDB on Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/scylla-web-installer.html">ScyllaDB Web Installer for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/install-scylla/install-on-linux.html">Install ScyllaDB Linux Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/install-jmx.html">Install scylla-jmx Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/install-scylla/run-in-docker.html">Run ScyllaDB in Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/unified-installer.html">Install ScyllaDB Without root Privileges</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/air-gapped-install.html">Air-gapped Server Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/disable-housekeeping.html">ScyllaDB Housekeeping and how to disable it</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/dev-mod.html">ScyllaDB Developer Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/configure.html">Configure ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/config-commands.html">ScyllaDB Configuration Reference</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../getting-started/requirements.html">ScyllaDB Requirements</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/system-requirements.html">System Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/os-support.html">OS Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/cloud-instance-recommendations.html">Cloud Instance Recommendations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/scylla-in-a-shared-environment.html">ScyllaDB in a Shared Environment</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../using-scylla/migrate-scylla.html">Migrate to ScyllaDB</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../procedures/cassandra-to-scylla-migration-process.html">Migration Process from Cassandra to ScyllaDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/cassandra-compatibility.html">ScyllaDB and Apache Cassandra Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/mig-tool-review.html">Migration Tools Overview</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../using-scylla/integrations/index.html">Integration Solutions</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-spark.html">Integrate ScyllaDB with Spark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-kairos.html">Integrate ScyllaDB with KairosDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-presto.html">Integrate ScyllaDB with Presto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-elasticsearch.html">Integrate ScyllaDB with Elasticsearch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-k8.html">Integrate ScyllaDB with Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-janus.html">Integrate ScyllaDB with the JanusGraph Graph Data System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-datadog.html">Integrate ScyllaDB with DataDog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-kafka.html">Integrate ScyllaDB with Kafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-iota.html">Integrate ScyllaDB with IOTA Chronicle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-spring.html">Integrate ScyllaDB with Spring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/sink-kafka-connector.html">Shard-Aware Kafka Connector for ScyllaDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-ansible.html">Install ScyllaDB with Ansible</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-databricks.html">Integrate ScyllaDB with Databricks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-jaeger.html">Integrate ScyllaDB with Jaeger Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/integrations/integration-mindsdb.html">Integrate ScyllaDB with MindsDB</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">ScyllaDB for Administrators</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon-chevron-right"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../admin.html">Administration Guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../procedures/index.html">Procedures</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../procedures/cluster-management/index.html">Cluster Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../procedures/backup-restore/index.html">Backup &amp; Restore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../procedures/config-change/index.html">Change Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../procedures/maintenance/index.html">Maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../procedures/tips/index.html">Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../benchmarking-scylla.html">Benchmarking ScyllaDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../procedures/cassandra-to-scylla-migration-process.html">Migrate from Cassandra to ScyllaDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/installation-common/disable-housekeeping.html">Disable Housekeeping</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Security</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon-chevron-right"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="security-checklist.html">ScyllaDB Security Checklist</a></li>
<li class="toctree-l3"><a class="reference internal" href="authentication.html">Enable Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime-authentication.html">Enable and Disable Authentication Without Downtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-superuser.html">Creating a Custom Superuser</a></li>
<li class="toctree-l3"><a class="reference internal" href="gen-cqlsh-file.html">Generate a cqlshrc File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/password-reset.html">Reset Authenticator Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="enable-authorization.html">Enable Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="authorization.html">Grant Authorization CQL Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="certificate-authentication.html">Certificate-based Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="rbac-usecase.html">Role Based Access Control (RBAC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="auditing.html">ScyllaDB Auditing Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="client-node-encryption.html">Encryption: Data in Transit Client to Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="node-node-encryption.html">Encryption: Data in Transit Node to Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="generate-certificate.html">Generating a self-signed Certificate Chain Using openssl</a></li>
<li class="toctree-l3"><a class="reference internal" href="saslauthd.html">Configure SaslauthdAuthenticator</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Encryption at Rest</a></li>
<li class="toctree-l3"><a class="reference internal" href="ldap-authentication.html">LDAP Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="ldap-authorization.html">LDAP Authorization (Role Management)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sbom.html">Software Bill Of Materials (SBOM)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../admin-tools/index.html">Admin Tools</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../nodetool.html">Nodetool Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cql/cqlsh.html">CQLSh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest.html">Admin REST API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using-scylla/tracing.html">Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/scylla-sstable.html">ScyllaDB SStable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/scylla-types.html">ScyllaDB Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/sstableloader.html">SSTableLoader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/cassandra-stress.html">cassandra-stress</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/sstabledump.html">SSTabledump</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/sstablemetadata.html">SSTableMetadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/logging.html">ScyllaDB Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/perftune.html">Seastar Perftune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/virtual-tables.html">Virtual Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/select-from-mutation-fragments.html">Reading mutation fragments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/maintenance-socket.html">Maintenance socket</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/maintenance-mode.html">Maintenance mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin-tools/task-manager.html">Task manager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://monitoring.docs.scylladb.com/">ScyllaDB Monitoring Stack</a></li>
<li class="toctree-l2"><a class="reference external" href="https://operator.docs.scylladb.com/">ScyllaDB Operator</a></li>
<li class="toctree-l2"><a class="reference external" href="https://manager.docs.scylladb.com/">ScyllaDB Manager</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../upgrade/index.html">Upgrade Procedures</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade/about-upgrade.html">About Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade/upgrade-guides/index.html">Upgrade Guides</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../system-configuration/index.html">System Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/system-configuration.html">System Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../admin.html">scylla.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../system-configuration/snitch.html">ScyllaDB Snitches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarking-scylla.html">Benchmarking ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diagnostics.html">ScyllaDB Diagnostic Tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../using-scylla/index.html">ScyllaDB for Developers</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.scylladb.com/stable/get-started/develop-with-scylladb/index.html">Develop with ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.scylladb.com/stable/get-started/develop-with-scylladb/tutorials-example-projects.html">Tutorials and Example Projects</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.scylladb.com/stable/get-started/learn-resources/index.html">Learn to Use ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using-scylla/alternator/index.html">ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.scylladb.com/stable/drivers/index.html">ScyllaDB Drivers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../cql/index.html">CQL Reference</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label for="toctree-checkbox-13"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cql/cqlsh.html">CQLSh: the CQL shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/appendices.html">Reserved CQL Keywords and Types (Appendices)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/compaction.html">Compaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/consistency.html">Consistency Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/consistency-calculator.html">Consistency Level Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/ddl.html">Data Definition</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../cql/dml.html">Data Manipulation</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label for="toctree-checkbox-14"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../cql/dml/select.html">SELECT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cql/dml/insert.html">INSERT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cql/dml/update.html">UPDATE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cql/dml/delete.html">DELETE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cql/dml/batch.html">BATCH</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/types.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/secondary-indexes.html">Global Secondary Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/time-to-live.html">Expiring Data with Time to Live (TTL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/wasm.html">Wasm support for user-defined functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/json.html">JSON Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/mv.html">Materialized Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/describe-schema.html">DESCRIBE SCHEMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/service-levels.html">Service Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cql/cql-extensions.html">ScyllaDB CQL Extensions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label for="toctree-checkbox-15"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alternator/compatibility.html">ScyllaDB Alternator for DynamoDB users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alternator/new-apis.html">Alternator-specific APIs</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../features/index.html">Features</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label for="toctree-checkbox-16"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../features/lwt.html">Lightweight Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/secondary-indexes.html">Global Secondary Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/local-secondary-indexes.html">Local Secondary Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/materialized-views.html">Materialized Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/counters.html">Counters</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../features/cdc/index.html">Change Data Capture</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label for="toctree-checkbox-17"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-intro.html">CDC Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-log-table.html">The CDC Log Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-basic-operations.html">Basic operations in CDC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-streams.html">CDC Streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-stream-changes.html">CDC Stream Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-querying-streams.html">Querying CDC Streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-advanced-types.html">Advanced column types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-preimages.html">Preimages and postimages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../features/cdc/cdc-consistency.html">Data Consistency in CDC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../features/workload-attributes.html">Workload Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/workload-prioritization.html">Workload Prioritization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/backup-and-restore.html">Backup and Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/incremental-repair.html">Incremental Repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/vector-search.html">Vector Search</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../architecture/index.html">ScyllaDB Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label for="toctree-checkbox-18"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/tablets.html">Data Distribution with Tablets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/ringarchitecture/index.html">ScyllaDB Ring Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/architecture-fault-tolerance.html">ScyllaDB Fault Tolerance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/console-CL-full-demo.html">Consistency Level Console Demo</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../architecture/anti-entropy/index.html">ScyllaDB Anti-Entropy</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label for="toctree-checkbox-19"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../architecture/anti-entropy/hinted-handoff.html">ScyllaDB Hinted Handoff</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../architecture/anti-entropy/read-repair.html">ScyllaDB Read Repair</a></li>
<li class="toctree-l3"><a class="reference internal" href="../procedures/maintenance/repair.html">ScyllaDB Repair</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../architecture/sstable/index.html">SSTable</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label for="toctree-checkbox-20"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../architecture/sstable/sstable2/index.html">ScyllaDB SSTable - 2.x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../architecture/sstable/sstable3/index.html">ScyllaDB SSTable - 3.x</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/compaction/compaction-strategies.html">Compaction Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/raft.html">Raft Consensus Algorithm in ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/zero-token-nodes.html">Zero-token Nodes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting ScyllaDB</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label for="toctree-checkbox-21"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/support/index.html">Errors and Support</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label for="toctree-checkbox-22"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/report-scylla-problem.html">Report a ScyllaDB problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/error-messages/index.html">Error Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/log-level.html">Change Log Level</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/startup/index.html">ScyllaDB Startup</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label for="toctree-checkbox-23"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/change-ownership.html">Ownership Problems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/scylla-wont-start.html">ScyllaDB will not Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/python-error-no-module-named-yaml.html">ScyllaDB Python Script broken</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/upgrade/index.html">Upgrade</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label for="toctree-checkbox-24"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/missing-dotmount-files.html">Inaccessible configuration files after ScyllaDB upgrade</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/cluster/index.html">Cluster and Node</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label for="toctree-checkbox-25"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/handling-node-failures.html">Handling Node Failures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/failed-add-remove-replace.html">Failure to Add, Remove, or Replace a Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/failed-decommission.html">Failed Decommission Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/timeouts.html">Cluster Timeouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/node-joined-without-any-data.html">Node Joined With No Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/nodetool-nullpointerexception.html">NullPointerException</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/failed-schema-sync.html">Failed Schema Sync</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/modeling/index.html">Data Modeling</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label for="toctree-checkbox-26"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/large-partition-table.html">ScyllaDB Large Partitions Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/large-rows-large-cells-tables.html">ScyllaDB Large Rows and Cells Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/debugging-large-partition.html">Large Partitions Hunting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/failed-update-schema.html">Failure to Update the Schema</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/storage/index.html">Data Storage and SSTables</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label for="toctree-checkbox-27"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/space-up.html">Space Utilization Increasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/drop-table-space-up.html">Disk Space is not Reclaimed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/sstable-corruption.html">SSTable Corruption Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/pointless-compactions.html">Pointless Compactions</a></li>
<li class="toctree-l3"><a class="reference external" href="https://monitoring.docs.scylladb.com/stable/use-monitoring/advisor/heavyCompaction.html">Limiting Compaction</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/CQL/index.html">CQL</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label for="toctree-checkbox-28"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/time-zone.html">Time Range Query Fails</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/copy-from-failed.html">COPY FROM Fails</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/clients-table.html">CQL Connection Table</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/monitor/index.html">ScyllaDB Monitor and Manager</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label for="toctree-checkbox-29"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/manager-monitoring-integration.html">Manager and Monitoring integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/reverse-dns-sshd.html">Manager lists healthy nodes as down</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../troubleshooting/install-remove/index.html">Installation and Removal</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label for="toctree-checkbox-30"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/autoremove-ubuntu.html">Removing ScyllaDB on Ubuntu breaks system packages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../kb/index.html">Knowledge Base</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/><label for="toctree-checkbox-31"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../kb/cdc-experimental-upgrade.html">Upgrading from experimental CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/compaction.html">Compaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/consistency.html">Consistency in ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/count-all-rows.html">Counting all rows in a table is slow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/cqlsh-more.html">CQL Query Does Not Display Entire Result Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/cqlsh-results.html">When CQLSh query returns partial results with followed by “More”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/custom-user.html">Run ScyllaDB and supporting services as a custom user:group</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/customizing-cpuset.html">Customizing CPUSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/decode-stack-trace.html">Decoding Stack Traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/disk-utilization.html">Snapshots and Disk Utilization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/dpdk-hardware.html">DPDK mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/flamegraph.html">Debug your database with Flame Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/garbage-collection-ics.html">Efficient Tombstone Garbage Collection in ICS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/gc-grace-seconds.html">How to Change gc_grace_seconds for a Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/gossip.html">Gossip in ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/increase-permission-cache.html">Increase Permission Cache to Avoid Non-paged Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/lwt-differences.html">How does ScyllaDB LWT Differ from Apache Cassandra ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/map-cpu.html">Map CPUs to ScyllaDB Shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/memory-usage.html">ScyllaDB Memory Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/ntp.html">NTP Configuration for ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/perftune-modes-sync.html">Updating the Mode in perftune.yaml After a ScyllaDB Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/posix.html">POSIX networking for ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/quiz-administrators.html">ScyllaDB consistency quiz for administrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/raid-device.html">Recreate RAID devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/rf-increase.html">How to Safely Increase the Replication Factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/scylla-and-spark-integration.html">ScyllaDB and Spark integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/scylla-limits-systemd.html">Increase ScyllaDB resource limits over systemd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/seed-nodes.html">ScyllaDB Seed Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/set-up-swap.html">How to Set up a Swap Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/snapshots.html">ScyllaDB Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/static-columns.html">ScyllaDB payload sent duplicated static columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/stop-local-repair.html">Stopping a local repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/system-limits.html">System Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/tombstones-flush.html">How to flush old tombstones from a table</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/ttl-facts.html">Time to Live (TTL) and Compaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/unresponsive-nodes.html">ScyllaDB Nodes are Unresponsive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/update-pk.html">Update a Primary Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/use-perf.html">Using the perf utility with ScyllaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kb/yaml-address.html">Configure ScyllaDB Networking with Multiple NIC/IP Combinations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/><label for="toctree-checkbox-32"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/aws-images.html">AWS Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/azure-images.html">Azure Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/gcp-images.html">GCP Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/configuration-parameters.html">Configuration Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/limits.html">Limits</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/><label for="toctree-checkbox-33"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/authorization-cache.html">Authorization Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/cache-service.html">Cache Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/collectd.html">Collectd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/column-family.html">Column Family</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/commit-log.html">Commit Log</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/compaction-manager.html">Compaction Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/endpoint-snitch-info.html">Endpoint Snitch Info</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/error-injection.html">Error Injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/failure-detector.html">Failure Detector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/gossiper.html">Gossiper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/hinted-handoff.html">Hinted Handoff</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/lsa.html">LSA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/messaging-service.html">Messaging Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/raft.html">Raft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/storage-proxy.html">Storage Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/storage-service.html">Storage Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/stream-manager.html">Stream Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/system.html">System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/task-manager-test.html">Task Manager Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/task-manager.html">Task Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/tasks.html">Tasks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/metrics.html">Metrics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">ScyllaDB FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://enterprise.docs.scylladb.com/branch-2024.2/">2024.2 and earlier documentation</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>

        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com"></a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/" target="_blank">Docs</a>
                <a class="footer-links__link" href="https://docs.scylladb.com/stable/get-started/develop-with-scylladb/tutorials-example-projects.html" target="_blank">Tutorials</a>
                <a class="footer-links__link" href="https://university.scylladb.com/" target="_blank">University</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/"
                   target="_blank">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/" target="_blank">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <i class="icon-slack"></i>
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <i class="icon-docs-community"></i>
                    </span>
                </a>
            </div>
        </div>

        
            <div class="footer-copyright">
                
                    
                        &#169; 2026, ScyllaDB. All rights reserved.
                    
                    | <a class="footer-copyright__link" href="https://www.scylladb.com/tos/" target="_blank">Terms of Service</a>
                    | <a class="footer-copyright__link" href="https://www.scylladb.com/privacy/" target="_blank">Privacy Policy</a>
                    | ScyllaDB, and ScyllaDB Cloud, are registered trademarks of ScyllaDB, Inc.
                
            </div>
        


        <div class="footer-bottom">
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 06 Jan 2026.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a class="footer-bottom__link" href="http://sphinx-doc.org/">Sphinx 8.1.3</a> &amp;
                <a class="footer-bottom__link" href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.8.10</a>
            </div>
        </div>
    </div>
    
        <biel-button class="footer-ask-ai" project="ddfdo8m94k"
                     header-title="ScyllaDB chatbot (beta)"
                     button-position="bottom-right"
                     modal-position="bottom-right"
                     button-style="dark">
            Ask AI
        </biel-button>
    
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                    style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>